"use strict";(()=>{var e={};e.id=701,e.ids=[701],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},6005:e=>{e.exports=require("node:crypto")},7738:(e,s,t)=>{t.r(s),t.d(s,{originalPathname:()=>N,patchFetch:()=>T,requestAsyncStorage:()=>f,routeModule:()=>w,serverHooks:()=>y,staticGenerationAsyncStorage:()=>h});var r={};t.r(r),t.d(r,{DELETE:()=>j,GET:()=>x,POST:()=>E,PUT:()=>R});var n=t(9303),a=t(8716),o=t(670),u=t(1615),i=t(8632),c=t(2023),l=t.n(c),p=t(6385),m=t(3534),d=t(7070);async function g(){let e=await (0,u.cookies)(),s=await (0,i.iW)(e,m.d);return s.userId&&"admin"===s.role?s:null}async function x(e){try{if(!await g())return d.NextResponse.json({success:!1,message:"ไม่มีสิทธิ์ดำเนินการ"},{status:403});let{searchParams:s}=new URL(e.url),t=s.get("id");if(t){let e=await (0,p.E4)("SELECT id, username, full_name, email, phone, role, created_at FROM users WHERE id = $1",[t]);return d.NextResponse.json({success:!0,message:"Success",user:e})}{let e=await (0,p.Qd)("SELECT id, username, full_name, email, phone, role, created_at FROM users ORDER BY id DESC");return d.NextResponse.json({success:!0,message:"Success",users:e})}}catch(e){return console.error("Users GET error:",e),d.NextResponse.json({success:!1,message:e.message},{status:500})}}async function E(e){try{if(!await g())return d.NextResponse.json({success:!1,message:"ไม่มีสิทธิ์ดำเนินการ"},{status:403});let s=await e.json();if(!s.username||!s.password||!s.full_name)return d.NextResponse.json({success:!1,message:"กรุณากรอกข้อมูลให้ครบถ้วน"});if(await (0,p.E4)("SELECT id FROM users WHERE username = $1",[s.username]))return d.NextResponse.json({success:!1,message:"ชื่อผู้ใช้นี้มีอยู่แล้ว"});let t=await l().hash(s.password,10),r=await (0,p.$T)("users",{username:s.username,password:t,full_name:s.full_name,email:s.email||null,phone:s.phone||null,role:s.role||"user"});return d.NextResponse.json({success:!0,message:"เพิ่มผู้ใช้สำเร็จ",id:r})}catch(e){return console.error("Users POST error:",e),d.NextResponse.json({success:!1,message:e.message},{status:500})}}async function R(e){try{if(!await g())return d.NextResponse.json({success:!1,message:"ไม่มีสิทธิ์ดำเนินการ"},{status:403});let s=await e.json();if(!s.id)return d.NextResponse.json({success:!1,message:"Missing user ID"});let t={full_name:s.full_name,email:s.email||null,phone:s.phone||null,role:s.role};return s.password&&(t.password=await l().hash(s.password,10)),await (0,p.Vx)("users",t,"id = ?",[s.id]),d.NextResponse.json({success:!0,message:"แก้ไขข้อมูลผู้ใช้สำเร็จ"})}catch(e){return console.error("Users PUT error:",e),d.NextResponse.json({success:!1,message:e.message},{status:500})}}async function j(e){try{let s=await g();if(!s)return d.NextResponse.json({success:!1,message:"ไม่มีสิทธิ์ดำเนินการ"},{status:403});let{searchParams:t}=new URL(e.url),r=t.get("id");if(!r)return d.NextResponse.json({success:!1,message:"Missing user ID"});if(parseInt(r)===s.userId)return d.NextResponse.json({success:!1,message:"ไม่สามารถลบบัญชีตัวเองได้"});return await (0,p.Od)("users","id = ?",[r]),d.NextResponse.json({success:!0,message:"ลบผู้ใช้สำเร็จ"})}catch(e){return console.error("Users DELETE error:",e),d.NextResponse.json({success:!1,message:e.message},{status:500})}}let w=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/users/route",pathname:"/api/users",filename:"route",bundlePath:"app/api/users/route"},resolvedPagePath:"C:\\Users\\RareMz\\Test\\src\\app\\api\\users\\route.js",nextConfigOutput:"",userland:r}),{requestAsyncStorage:f,staticGenerationAsyncStorage:h,serverHooks:y}=w,N="/api/users/route";function T(){return(0,o.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:h})}},6385:(e,s,t)=>{t.d(s,{$T:()=>u,E4:()=>a,Od:()=>c,Qd:()=>o,Vx:()=>i});let r=(0,t(2237).qn)(process.env.DATABASE_URL);async function n(e,s=[]){return await r(e,s)}async function a(e,s=[]){return(await n(e,s))[0]||null}async function o(e,s=[]){return await n(e,s)}async function u(e,s){let t=Object.keys(s).join(", "),n=Object.keys(s).map((e,s)=>`$${s+1}`).join(", "),a=Object.values(s),o=`INSERT INTO ${e} (${t}) VALUES (${n}) RETURNING id`,u=await r(o,a);return u[0]?.id}async function i(e,s,t,n=[]){let a=Object.keys(s).map((e,s)=>`${e} = $${s+1}`).join(", "),o=[...Object.values(s),...n],u=Object.keys(s).length+1,i=t.replace(/\?/g,()=>`$${u++}`),c=`UPDATE ${e} SET ${a} WHERE ${i}`;return(await r(c,o)).length}async function c(e,s,t=[]){let n=1,a=s.replace(/\?/g,()=>`$${n++}`),o=`DELETE FROM ${e} WHERE ${a}`;return(await r(o,t)).length}},3534:(e,s,t)=>{t.d(s,{d:()=>r});let r={password:process.env.SESSION_SECRET||"complex_password_at_least_32_characters_long",cookieName:"shop_license_session",cookieOptions:{secure:!0,httpOnly:!0,sameSite:"lax",maxAge:1800}}}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[276,397,23],()=>t(7738));module.exports=r})();