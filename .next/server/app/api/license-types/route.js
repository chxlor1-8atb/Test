"use strict";(()=>{var e={};e.id=606,e.ids=[606],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6005:e=>{e.exports=require("node:crypto")},3551:(e,s,t)=>{t.r(s),t.d(s,{originalPathname:()=>N,patchFetch:()=>T,requestAsyncStorage:()=>R,routeModule:()=>x,serverHooks:()=>w,staticGenerationAsyncStorage:()=>j});var n={};t.r(n),t.d(n,{DELETE:()=>E,GET:()=>y,POST:()=>m,PUT:()=>g});var a=t(9303),r=t(8716),i=t(670),c=t(1615),o=t(8632),u=t(6385),l=t(3534),p=t(7070);async function d(){let e=await (0,c.cookies)(),s=await (0,o.iW)(e,l.d);return s.userId?s:null}async function y(e){try{if(!await d())return p.NextResponse.json({success:!1,message:"Not authenticated"},{status:401});let{searchParams:s}=new URL(e.url),t=s.get("id");if(t){let e=await (0,u.E4)("SELECT * FROM license_types WHERE id = $1",[t]);return p.NextResponse.json({success:!0,message:"Success",type:e})}{let e=await (0,u.Qd)(`SELECT lt.*, 
                        (SELECT COUNT(*) FROM licenses l WHERE l.license_type_id = lt.id) as license_count
                 FROM license_types lt 
                 ORDER BY lt.id ASC`);return p.NextResponse.json({success:!0,message:"Success",types:e})}}catch(e){return console.error("License types GET error:",e),p.NextResponse.json({success:!1,message:e.message},{status:500})}}async function m(e){try{let s=await d();if(!s||"admin"!==s.role)return p.NextResponse.json({success:!1,message:"ไม่มีสิทธิ์ดำเนินการ"},{status:403});let t=await e.json();if(!t.name)return p.NextResponse.json({success:!1,message:"กรุณากรอกชื่อประเภทใบอนุญาต"});let n=await (0,u.$T)("license_types",{name:t.name,description:t.description||null,validity_days:t.validity_days||365});return p.NextResponse.json({success:!0,message:"เพิ่มประเภทใบอนุญาตสำเร็จ",id:n})}catch(e){return console.error("License types POST error:",e),p.NextResponse.json({success:!1,message:e.message},{status:500})}}async function g(e){try{let s=await d();if(!s||"admin"!==s.role)return p.NextResponse.json({success:!1,message:"ไม่มีสิทธิ์ดำเนินการ"},{status:403});let t=await e.json();if(!t.id)return p.NextResponse.json({success:!1,message:"Missing license type ID"});return await (0,u.Vx)("license_types",{name:t.name,description:t.description||null,validity_days:t.validity_days||365},"id = ?",[t.id]),p.NextResponse.json({success:!0,message:"แก้ไขประเภทใบอนุญาตสำเร็จ"})}catch(e){return console.error("License types PUT error:",e),p.NextResponse.json({success:!1,message:e.message},{status:500})}}async function E(e){try{let s=await d();if(!s||"admin"!==s.role)return p.NextResponse.json({success:!1,message:"ไม่มีสิทธิ์ดำเนินการ"},{status:403});let{searchParams:t}=new URL(e.url),n=t.get("id");if(!n)return p.NextResponse.json({success:!1,message:"Missing license type ID"});let a=await (0,u.E4)("SELECT COUNT(*) as count FROM licenses WHERE license_type_id = $1",[n]);if(parseInt(a?.count)>0)return p.NextResponse.json({success:!1,message:"ไม่สามารถลบได้ เนื่องจากมีใบอนุญาตใช้ประเภทนี้อยู่"});return await (0,u.Od)("license_types","id = ?",[n]),p.NextResponse.json({success:!0,message:"ลบประเภทใบอนุญาตสำเร็จ"})}catch(e){return console.error("License types DELETE error:",e),p.NextResponse.json({success:!1,message:e.message},{status:500})}}let x=new a.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/license-types/route",pathname:"/api/license-types",filename:"route",bundlePath:"app/api/license-types/route"},resolvedPagePath:"C:\\Users\\RareMz\\Test\\src\\app\\api\\license-types\\route.js",nextConfigOutput:"",userland:n}),{requestAsyncStorage:R,staticGenerationAsyncStorage:j,serverHooks:w}=x,N="/api/license-types/route";function T(){return(0,i.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:j})}},6385:(e,s,t)=>{t.d(s,{$T:()=>c,E4:()=>r,Od:()=>u,Qd:()=>i,Vx:()=>o});let n=(0,t(2237).qn)(process.env.DATABASE_URL);async function a(e,s=[]){return await n(e,s)}async function r(e,s=[]){return(await a(e,s))[0]||null}async function i(e,s=[]){return await a(e,s)}async function c(e,s){let t=Object.keys(s).join(", "),a=Object.keys(s).map((e,s)=>`$${s+1}`).join(", "),r=Object.values(s),i=`INSERT INTO ${e} (${t}) VALUES (${a}) RETURNING id`,c=await n(i,r);return c[0]?.id}async function o(e,s,t,a=[]){let r=Object.keys(s).map((e,s)=>`${e} = $${s+1}`).join(", "),i=[...Object.values(s),...a],c=Object.keys(s).length+1,o=t.replace(/\?/g,()=>`$${c++}`),u=`UPDATE ${e} SET ${r} WHERE ${o}`;return(await n(u,i)).length}async function u(e,s,t=[]){let a=1,r=s.replace(/\?/g,()=>`$${a++}`),i=`DELETE FROM ${e} WHERE ${r}`;return(await n(i,t)).length}},3534:(e,s,t)=>{t.d(s,{d:()=>n});let n={password:process.env.SESSION_SECRET||"complex_password_at_least_32_characters_long",cookieName:"shop_license_session",cookieOptions:{secure:!0,httpOnly:!0,sameSite:"lax",maxAge:1800}}}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),n=s.X(0,[276,397],()=>t(3551));module.exports=n})();