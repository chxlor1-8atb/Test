"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/notifications/route";
exports.ids = ["app/api/notifications/route"];
exports.modules = {

/***/ "./action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "./request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "./static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "node:crypto":
/*!******************************!*\
  !*** external "node:crypto" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:crypto");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fnotifications%2Froute&page=%2Fapi%2Fnotifications%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fnotifications%2Froute.js&appDir=C%3A%5CUsers%5CRareMz%5CTest%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CRareMz%5CTest&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fnotifications%2Froute&page=%2Fapi%2Fnotifications%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fnotifications%2Froute.js&appDir=C%3A%5CUsers%5CRareMz%5CTest%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CRareMz%5CTest&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_RareMz_Test_src_app_api_notifications_route_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/notifications/route.js */ \"(rsc)/./src/app/api/notifications/route.js\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/notifications/route\",\n        pathname: \"/api/notifications\",\n        filename: \"route\",\n        bundlePath: \"app/api/notifications/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\RareMz\\\\Test\\\\src\\\\app\\\\api\\\\notifications\\\\route.js\",\n    nextConfigOutput,\n    userland: C_Users_RareMz_Test_src_app_api_notifications_route_js__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/notifications/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZub3RpZmljYXRpb25zJTJGcm91dGUmcGFnZT0lMkZhcGklMkZub3RpZmljYXRpb25zJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGbm90aWZpY2F0aW9ucyUyRnJvdXRlLmpzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNSYXJlTXolNUNUZXN0JTVDc3JjJTVDYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj1DJTNBJTVDVXNlcnMlNUNSYXJlTXolNUNUZXN0JmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUNlO0FBQzVGO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2hvcC1saWNlbnNlLXN5c3RlbS8/NDcyZCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCJDOlxcXFxVc2Vyc1xcXFxSYXJlTXpcXFxcVGVzdFxcXFxzcmNcXFxcYXBwXFxcXGFwaVxcXFxub3RpZmljYXRpb25zXFxcXHJvdXRlLmpzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9ub3RpZmljYXRpb25zL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvbm90aWZpY2F0aW9uc1wiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvbm90aWZpY2F0aW9ucy9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIkM6XFxcXFVzZXJzXFxcXFJhcmVNelxcXFxUZXN0XFxcXHNyY1xcXFxhcHBcXFxcYXBpXFxcXG5vdGlmaWNhdGlvbnNcXFxccm91dGUuanNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL25vdGlmaWNhdGlvbnMvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fnotifications%2Froute&page=%2Fapi%2Fnotifications%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fnotifications%2Froute.js&appDir=C%3A%5CUsers%5CRareMz%5CTest%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CRareMz%5CTest&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/notifications/route.js":
/*!********************************************!*\
  !*** ./src/app/api/notifications/route.js ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n/* harmony import */ var iron_session__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! iron-session */ \"(rsc)/./node_modules/iron-session/dist/index.js\");\n/* harmony import */ var _lib_session__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/session */ \"(rsc)/./src/lib/session.js\");\n/* harmony import */ var _lib_db__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/db */ \"(rsc)/./src/lib/db.js\");\n/* harmony import */ var _lib_telegram__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/telegram */ \"(rsc)/./src/lib/telegram.js\");\n/* harmony import */ var _lib_notification_service__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/lib/notification-service */ \"(rsc)/./src/lib/notification-service.js\");\n\n\n\n\n\n\n\nasync function GET(request) {\n    const session = await getSession();\n    if (!session.userId) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            message: \"Unauthorized\"\n        }, {\n            status: 401\n        });\n    }\n    const { searchParams } = new URL(request.url);\n    const action = searchParams.get(\"action\") || \"settings\";\n    if (action === \"settings\") {\n        return await handleGetSettings();\n    } else if (action === \"logs\") {\n        return await handleGetLogs();\n    }\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        success: false,\n        message: \"Invalid action\"\n    });\n}\nasync function POST(request) {\n    const session = await getSession();\n    if (!session.userId) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            message: \"Unauthorized\"\n        }, {\n            status: 401\n        });\n    }\n    const { searchParams } = new URL(request.url);\n    const action = searchParams.get(\"action\");\n    try {\n        if (action === \"save_settings\") {\n            if (session.role !== \"admin\") {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    message: \"Admin access required\"\n                }, {\n                    status: 403\n                });\n            }\n            return await handleSaveSettings(request);\n        } else if (action === \"test\") {\n            return await handleTestNotification();\n        } else if (action === \"check-expiring\" || action === \"send_expiry\") {\n            return await handleCheckExpiring();\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            message: \"Invalid action\"\n        });\n    } catch (error) {\n        console.error(\"Notification API Error:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            message: error.message\n        }, {\n            status: 500\n        });\n    }\n}\nasync function getSession() {\n    const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)();\n    return await (0,iron_session__WEBPACK_IMPORTED_MODULE_6__.getIronSession)(cookieStore, _lib_session__WEBPACK_IMPORTED_MODULE_2__.sessionOptions);\n}\n// --- Handlers ---\nasync function handleGetSettings() {\n    let settings = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_3__.fetchOne)(\"SELECT * FROM notification_settings WHERE id = 1\");\n    if (!settings) {\n        // Create default if not exists\n        await (0,_lib_db__WEBPACK_IMPORTED_MODULE_3__.insert)(\"notification_settings\", {\n            id: 1,\n            days_before_expiry: 30,\n            is_active: 0\n        });\n        settings = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_3__.fetchOne)(\"SELECT * FROM notification_settings WHERE id = 1\");\n    }\n    // Mask token\n    if (settings && settings.telegram_bot_token) {\n        const token = settings.telegram_bot_token;\n        const start = token.substring(0, 4);\n        const end = token.substring(token.length - 4);\n        settings.telegram_bot_token_masked = `${start}...${end}`;\n    }\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        success: true,\n        settings\n    });\n}\nasync function handleGetLogs() {\n    const logs = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_3__.fetchAll)(`\r\n        SELECT nl.*, l.license_number, s.shop_name\r\n        FROM notification_logs nl\r\n        LEFT JOIN licenses l ON nl.license_id = l.id\r\n        LEFT JOIN shops s ON l.shop_id = s.id\r\n        ORDER BY nl.sent_at DESC\r\n        LIMIT 50\r\n    `);\n    // Assuming 50 limit for now, PHPs config had a constant\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        success: true,\n        logs\n    });\n}\nasync function handleSaveSettings(request) {\n    const data = await request.json();\n    // Prepare update data\n    const updateData = {\n        days_before_expiry: parseInt(data.days_before_expiry || 30),\n        is_active: data.is_active ? 1 : 0\n    };\n    if (data.telegram_bot_token) {\n        updateData.telegram_bot_token = data.telegram_bot_token;\n    }\n    if (data.telegram_chat_id) {\n        updateData.telegram_chat_id = data.telegram_chat_id;\n    }\n    const exists = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_3__.fetchOne)(\"SELECT id FROM notification_settings WHERE id = 1\");\n    if (exists) {\n        await (0,_lib_db__WEBPACK_IMPORTED_MODULE_3__.update)(\"notification_settings\", updateData, \"id = $1\", [\n            1\n        ]);\n    } else {\n        updateData.id = 1;\n        await (0,_lib_db__WEBPACK_IMPORTED_MODULE_3__.insert)(\"notification_settings\", updateData);\n    }\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        success: true,\n        message: \"บันทึกการตั้งค่าสำเร็จ\"\n    });\n}\nasync function handleTestNotification() {\n    const { telegramService, notificationService } = await getServices();\n    // Validate config first\n    if (!telegramService.botToken || !telegramService.chatId) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            message: \"กรุณาตั้งค่า Telegram Bot Token และ Chat ID ก่อน\"\n        });\n    }\n    const result = await notificationService.sendTestNotification();\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(result);\n}\nasync function handleCheckExpiring() {\n    const { telegramService, notificationService } = await getServices();\n    // Validate config\n    if (!telegramService.botToken || !telegramService.chatId) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            message: \"กรุณาตั้งค่า Telegram Bot Token และ Chat ID ก่อน\"\n        });\n    }\n    const result = await notificationService.checkAndSendExpiryNotifications();\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(result);\n}\nasync function getServices() {\n    let settings = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_3__.fetchOne)(\"SELECT * FROM notification_settings WHERE id = 1\");\n    if (!settings) {\n        await (0,_lib_db__WEBPACK_IMPORTED_MODULE_3__.insert)(\"notification_settings\", {\n            id: 1,\n            days_before_expiry: 30,\n            is_active: 0\n        });\n        settings = await (0,_lib_db__WEBPACK_IMPORTED_MODULE_3__.fetchOne)(\"SELECT * FROM notification_settings WHERE id = 1\");\n    }\n    const telegramService = new _lib_telegram__WEBPACK_IMPORTED_MODULE_4__.TelegramService(settings.telegram_bot_token, settings.telegram_chat_id);\n    const notificationService = new _lib_notification_service__WEBPACK_IMPORTED_MODULE_5__.NotificationService(telegramService, settings);\n    return {\n        telegramService,\n        notificationService\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9ub3RpZmljYXRpb25zL3JvdXRlLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUEyQztBQUNKO0FBQ087QUFDQztBQUNlO0FBQ2I7QUFDZ0I7QUFFMUQsZUFBZVUsSUFBSUMsT0FBTztJQUM3QixNQUFNQyxVQUFVLE1BQU1DO0lBQ3RCLElBQUksQ0FBQ0QsUUFBUUUsTUFBTSxFQUFFO1FBQ2pCLE9BQU9kLHFEQUFZQSxDQUFDZSxJQUFJLENBQUM7WUFBRUMsU0FBUztZQUFPQyxTQUFTO1FBQWUsR0FBRztZQUFFQyxRQUFRO1FBQUk7SUFDeEY7SUFFQSxNQUFNLEVBQUVDLFlBQVksRUFBRSxHQUFHLElBQUlDLElBQUlULFFBQVFVLEdBQUc7SUFDNUMsTUFBTUMsU0FBU0gsYUFBYUksR0FBRyxDQUFDLGFBQWE7SUFFN0MsSUFBSUQsV0FBVyxZQUFZO1FBQ3ZCLE9BQU8sTUFBTUU7SUFDakIsT0FBTyxJQUFJRixXQUFXLFFBQVE7UUFDMUIsT0FBTyxNQUFNRztJQUNqQjtJQUVBLE9BQU96QixxREFBWUEsQ0FBQ2UsSUFBSSxDQUFDO1FBQUVDLFNBQVM7UUFBT0MsU0FBUztJQUFpQjtBQUN6RTtBQUVPLGVBQWVTLEtBQUtmLE9BQU87SUFDOUIsTUFBTUMsVUFBVSxNQUFNQztJQUN0QixJQUFJLENBQUNELFFBQVFFLE1BQU0sRUFBRTtRQUNqQixPQUFPZCxxREFBWUEsQ0FBQ2UsSUFBSSxDQUFDO1lBQUVDLFNBQVM7WUFBT0MsU0FBUztRQUFlLEdBQUc7WUFBRUMsUUFBUTtRQUFJO0lBQ3hGO0lBRUEsTUFBTSxFQUFFQyxZQUFZLEVBQUUsR0FBRyxJQUFJQyxJQUFJVCxRQUFRVSxHQUFHO0lBQzVDLE1BQU1DLFNBQVNILGFBQWFJLEdBQUcsQ0FBQztJQUVoQyxJQUFJO1FBQ0EsSUFBSUQsV0FBVyxpQkFBaUI7WUFDNUIsSUFBSVYsUUFBUWUsSUFBSSxLQUFLLFNBQVM7Z0JBQzFCLE9BQU8zQixxREFBWUEsQ0FBQ2UsSUFBSSxDQUFDO29CQUFFQyxTQUFTO29CQUFPQyxTQUFTO2dCQUF3QixHQUFHO29CQUFFQyxRQUFRO2dCQUFJO1lBQ2pHO1lBQ0EsT0FBTyxNQUFNVSxtQkFBbUJqQjtRQUNwQyxPQUFPLElBQUlXLFdBQVcsUUFBUTtZQUMxQixPQUFPLE1BQU1PO1FBQ2pCLE9BQU8sSUFBSVAsV0FBVyxvQkFBb0JBLFdBQVcsZUFBZTtZQUNoRSxPQUFPLE1BQU1RO1FBQ2pCO1FBRUEsT0FBTzlCLHFEQUFZQSxDQUFDZSxJQUFJLENBQUM7WUFBRUMsU0FBUztZQUFPQyxTQUFTO1FBQWlCO0lBQ3pFLEVBQUUsT0FBT2MsT0FBTztRQUNaQyxRQUFRRCxLQUFLLENBQUMsMkJBQTJCQTtRQUN6QyxPQUFPL0IscURBQVlBLENBQUNlLElBQUksQ0FBQztZQUFFQyxTQUFTO1lBQU9DLFNBQVNjLE1BQU1kLE9BQU87UUFBQyxHQUFHO1lBQUVDLFFBQVE7UUFBSTtJQUN2RjtBQUNKO0FBRUEsZUFBZUw7SUFDWCxNQUFNb0IsY0FBYyxNQUFNaEMscURBQU9BO0lBQ2pDLE9BQU8sTUFBTUMsNERBQWNBLENBQUMrQixhQUFhOUIsd0RBQWNBO0FBQzNEO0FBRUEsbUJBQW1CO0FBRW5CLGVBQWVxQjtJQUNYLElBQUlVLFdBQVcsTUFBTTlCLGlEQUFRQSxDQUFDO0lBRTlCLElBQUksQ0FBQzhCLFVBQVU7UUFDWCwrQkFBK0I7UUFDL0IsTUFBTTNCLCtDQUFNQSxDQUFDLHlCQUF5QjtZQUFFNEIsSUFBSTtZQUFHQyxvQkFBb0I7WUFBSUMsV0FBVztRQUFFO1FBQ3BGSCxXQUFXLE1BQU05QixpREFBUUEsQ0FBQztJQUM5QjtJQUVBLGFBQWE7SUFDYixJQUFJOEIsWUFBWUEsU0FBU0ksa0JBQWtCLEVBQUU7UUFDekMsTUFBTUMsUUFBUUwsU0FBU0ksa0JBQWtCO1FBQ3pDLE1BQU1FLFFBQVFELE1BQU1FLFNBQVMsQ0FBQyxHQUFHO1FBQ2pDLE1BQU1DLE1BQU1ILE1BQU1FLFNBQVMsQ0FBQ0YsTUFBTUksTUFBTSxHQUFHO1FBQzNDVCxTQUFTVSx5QkFBeUIsR0FBRyxDQUFDLEVBQUVKLE1BQU0sR0FBRyxFQUFFRSxJQUFJLENBQUM7SUFDNUQ7SUFFQSxPQUFPMUMscURBQVlBLENBQUNlLElBQUksQ0FBQztRQUFFQyxTQUFTO1FBQU1rQjtJQUFTO0FBQ3ZEO0FBRUEsZUFBZVQ7SUFDWCxNQUFNb0IsT0FBTyxNQUFNeEMsaURBQVFBLENBQUMsQ0FBQzs7Ozs7OztJQU83QixDQUFDO0lBQ0Qsd0RBQXdEO0lBRXhELE9BQU9MLHFEQUFZQSxDQUFDZSxJQUFJLENBQUM7UUFBRUMsU0FBUztRQUFNNkI7SUFBSztBQUNuRDtBQUVBLGVBQWVqQixtQkFBbUJqQixPQUFPO0lBQ3JDLE1BQU1tQyxPQUFPLE1BQU1uQyxRQUFRSSxJQUFJO0lBRS9CLHNCQUFzQjtJQUN0QixNQUFNZ0MsYUFBYTtRQUNmWCxvQkFBb0JZLFNBQVNGLEtBQUtWLGtCQUFrQixJQUFJO1FBQ3hEQyxXQUFXUyxLQUFLVCxTQUFTLEdBQUcsSUFBSTtJQUNwQztJQUVBLElBQUlTLEtBQUtSLGtCQUFrQixFQUFFO1FBQ3pCUyxXQUFXVCxrQkFBa0IsR0FBR1EsS0FBS1Isa0JBQWtCO0lBQzNEO0lBRUEsSUFBSVEsS0FBS0csZ0JBQWdCLEVBQUU7UUFDdkJGLFdBQVdFLGdCQUFnQixHQUFHSCxLQUFLRyxnQkFBZ0I7SUFDdkQ7SUFFQSxNQUFNQyxTQUFTLE1BQU05QyxpREFBUUEsQ0FBQztJQUM5QixJQUFJOEMsUUFBUTtRQUNSLE1BQU01QywrQ0FBTUEsQ0FBQyx5QkFBeUJ5QyxZQUFZLFdBQVc7WUFBQztTQUFFO0lBQ3BFLE9BQU87UUFDSEEsV0FBV1osRUFBRSxHQUFHO1FBQ2hCLE1BQU01QiwrQ0FBTUEsQ0FBQyx5QkFBeUJ3QztJQUMxQztJQUVBLE9BQU8vQyxxREFBWUEsQ0FBQ2UsSUFBSSxDQUFDO1FBQUVDLFNBQVM7UUFBTUMsU0FBUztJQUF5QjtBQUNoRjtBQUVBLGVBQWVZO0lBQ1gsTUFBTSxFQUFFc0IsZUFBZSxFQUFFQyxtQkFBbUIsRUFBRSxHQUFHLE1BQU1DO0lBRXZELHdCQUF3QjtJQUN4QixJQUFJLENBQUNGLGdCQUFnQkcsUUFBUSxJQUFJLENBQUNILGdCQUFnQkksTUFBTSxFQUFFO1FBQ3RELE9BQU92RCxxREFBWUEsQ0FBQ2UsSUFBSSxDQUFDO1lBQUVDLFNBQVM7WUFBT0MsU0FBUztRQUFtRDtJQUMzRztJQUVBLE1BQU11QyxTQUFTLE1BQU1KLG9CQUFvQkssb0JBQW9CO0lBQzdELE9BQU96RCxxREFBWUEsQ0FBQ2UsSUFBSSxDQUFDeUM7QUFDN0I7QUFFQSxlQUFlMUI7SUFDWCxNQUFNLEVBQUVxQixlQUFlLEVBQUVDLG1CQUFtQixFQUFFLEdBQUcsTUFBTUM7SUFFdkQsa0JBQWtCO0lBQ2xCLElBQUksQ0FBQ0YsZ0JBQWdCRyxRQUFRLElBQUksQ0FBQ0gsZ0JBQWdCSSxNQUFNLEVBQUU7UUFDdEQsT0FBT3ZELHFEQUFZQSxDQUFDZSxJQUFJLENBQUM7WUFBRUMsU0FBUztZQUFPQyxTQUFTO1FBQW1EO0lBQzNHO0lBRUEsTUFBTXVDLFNBQVMsTUFBTUosb0JBQW9CTSwrQkFBK0I7SUFDeEUsT0FBTzFELHFEQUFZQSxDQUFDZSxJQUFJLENBQUN5QztBQUM3QjtBQUVBLGVBQWVIO0lBQ1gsSUFBSW5CLFdBQVcsTUFBTTlCLGlEQUFRQSxDQUFDO0lBQzlCLElBQUksQ0FBQzhCLFVBQVU7UUFDWCxNQUFNM0IsK0NBQU1BLENBQUMseUJBQXlCO1lBQUU0QixJQUFJO1lBQUdDLG9CQUFvQjtZQUFJQyxXQUFXO1FBQUU7UUFDcEZILFdBQVcsTUFBTTlCLGlEQUFRQSxDQUFDO0lBQzlCO0lBRUEsTUFBTStDLGtCQUFrQixJQUFJM0MsMERBQWVBLENBQUMwQixTQUFTSSxrQkFBa0IsRUFBRUosU0FBU2UsZ0JBQWdCO0lBQ2xHLE1BQU1HLHNCQUFzQixJQUFJM0MsMEVBQW1CQSxDQUFDMEMsaUJBQWlCakI7SUFFckUsT0FBTztRQUFFaUI7UUFBaUJDO0lBQW9CO0FBQ2xEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2hvcC1saWNlbnNlLXN5c3RlbS8uL3NyYy9hcHAvYXBpL25vdGlmaWNhdGlvbnMvcm91dGUuanM/MTg1ZCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XHJcbmltcG9ydCB7IGNvb2tpZXMgfSBmcm9tICduZXh0L2hlYWRlcnMnO1xyXG5pbXBvcnQgeyBnZXRJcm9uU2Vzc2lvbiB9IGZyb20gJ2lyb24tc2Vzc2lvbic7XHJcbmltcG9ydCB7IHNlc3Npb25PcHRpb25zIH0gZnJvbSAnQC9saWIvc2Vzc2lvbic7XHJcbmltcG9ydCB7IGZldGNoT25lLCBmZXRjaEFsbCwgdXBkYXRlLCBpbnNlcnQgfSBmcm9tICdAL2xpYi9kYic7XHJcbmltcG9ydCB7IFRlbGVncmFtU2VydmljZSB9IGZyb20gJ0AvbGliL3RlbGVncmFtJztcclxuaW1wb3J0IHsgTm90aWZpY2F0aW9uU2VydmljZSB9IGZyb20gJ0AvbGliL25vdGlmaWNhdGlvbi1zZXJ2aWNlJztcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxdWVzdCkge1xyXG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGdldFNlc3Npb24oKTtcclxuICAgIGlmICghc2Vzc2lvbi51c2VySWQpIHtcclxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogJ1VuYXV0aG9yaXplZCcgfSwgeyBzdGF0dXM6IDQwMSB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IHNlYXJjaFBhcmFtcyB9ID0gbmV3IFVSTChyZXF1ZXN0LnVybCk7XHJcbiAgICBjb25zdCBhY3Rpb24gPSBzZWFyY2hQYXJhbXMuZ2V0KCdhY3Rpb24nKSB8fCAnc2V0dGluZ3MnO1xyXG5cclxuICAgIGlmIChhY3Rpb24gPT09ICdzZXR0aW5ncycpIHtcclxuICAgICAgICByZXR1cm4gYXdhaXQgaGFuZGxlR2V0U2V0dGluZ3MoKTtcclxuICAgIH0gZWxzZSBpZiAoYWN0aW9uID09PSAnbG9ncycpIHtcclxuICAgICAgICByZXR1cm4gYXdhaXQgaGFuZGxlR2V0TG9ncygpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiAnSW52YWxpZCBhY3Rpb24nIH0pO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0KSB7XHJcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgZ2V0U2Vzc2lvbigpO1xyXG4gICAgaWYgKCFzZXNzaW9uLnVzZXJJZCkge1xyXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiAnVW5hdXRob3JpemVkJyB9LCB7IHN0YXR1czogNDAxIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgc2VhcmNoUGFyYW1zIH0gPSBuZXcgVVJMKHJlcXVlc3QudXJsKTtcclxuICAgIGNvbnN0IGFjdGlvbiA9IHNlYXJjaFBhcmFtcy5nZXQoJ2FjdGlvbicpO1xyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgICAgaWYgKGFjdGlvbiA9PT0gJ3NhdmVfc2V0dGluZ3MnKSB7XHJcbiAgICAgICAgICAgIGlmIChzZXNzaW9uLnJvbGUgIT09ICdhZG1pbicpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiAnQWRtaW4gYWNjZXNzIHJlcXVpcmVkJyB9LCB7IHN0YXR1czogNDAzIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCBoYW5kbGVTYXZlU2V0dGluZ3MocmVxdWVzdCk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24gPT09ICd0ZXN0Jykge1xyXG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgaGFuZGxlVGVzdE5vdGlmaWNhdGlvbigpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uID09PSAnY2hlY2stZXhwaXJpbmcnIHx8IGFjdGlvbiA9PT0gJ3NlbmRfZXhwaXJ5Jykge1xyXG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgaGFuZGxlQ2hlY2tFeHBpcmluZygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6ICdJbnZhbGlkIGFjdGlvbicgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ05vdGlmaWNhdGlvbiBBUEkgRXJyb3I6JywgZXJyb3IpO1xyXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIH0sIHsgc3RhdHVzOiA1MDAgfSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGdldFNlc3Npb24oKSB7XHJcbiAgICBjb25zdCBjb29raWVTdG9yZSA9IGF3YWl0IGNvb2tpZXMoKTtcclxuICAgIHJldHVybiBhd2FpdCBnZXRJcm9uU2Vzc2lvbihjb29raWVTdG9yZSwgc2Vzc2lvbk9wdGlvbnMpO1xyXG59XHJcblxyXG4vLyAtLS0gSGFuZGxlcnMgLS0tXHJcblxyXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVHZXRTZXR0aW5ncygpIHtcclxuICAgIGxldCBzZXR0aW5ncyA9IGF3YWl0IGZldGNoT25lKFwiU0VMRUNUICogRlJPTSBub3RpZmljYXRpb25fc2V0dGluZ3MgV0hFUkUgaWQgPSAxXCIpO1xyXG5cclxuICAgIGlmICghc2V0dGluZ3MpIHtcclxuICAgICAgICAvLyBDcmVhdGUgZGVmYXVsdCBpZiBub3QgZXhpc3RzXHJcbiAgICAgICAgYXdhaXQgaW5zZXJ0KCdub3RpZmljYXRpb25fc2V0dGluZ3MnLCB7IGlkOiAxLCBkYXlzX2JlZm9yZV9leHBpcnk6IDMwLCBpc19hY3RpdmU6IDAgfSk7XHJcbiAgICAgICAgc2V0dGluZ3MgPSBhd2FpdCBmZXRjaE9uZShcIlNFTEVDVCAqIEZST00gbm90aWZpY2F0aW9uX3NldHRpbmdzIFdIRVJFIGlkID0gMVwiKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBNYXNrIHRva2VuXHJcbiAgICBpZiAoc2V0dGluZ3MgJiYgc2V0dGluZ3MudGVsZWdyYW1fYm90X3Rva2VuKSB7XHJcbiAgICAgICAgY29uc3QgdG9rZW4gPSBzZXR0aW5ncy50ZWxlZ3JhbV9ib3RfdG9rZW47XHJcbiAgICAgICAgY29uc3Qgc3RhcnQgPSB0b2tlbi5zdWJzdHJpbmcoMCwgNCk7XHJcbiAgICAgICAgY29uc3QgZW5kID0gdG9rZW4uc3Vic3RyaW5nKHRva2VuLmxlbmd0aCAtIDQpO1xyXG4gICAgICAgIHNldHRpbmdzLnRlbGVncmFtX2JvdF90b2tlbl9tYXNrZWQgPSBgJHtzdGFydH0uLi4ke2VuZH1gO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IHN1Y2Nlc3M6IHRydWUsIHNldHRpbmdzIH0pO1xyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVHZXRMb2dzKCkge1xyXG4gICAgY29uc3QgbG9ncyA9IGF3YWl0IGZldGNoQWxsKGBcclxuICAgICAgICBTRUxFQ1QgbmwuKiwgbC5saWNlbnNlX251bWJlciwgcy5zaG9wX25hbWVcclxuICAgICAgICBGUk9NIG5vdGlmaWNhdGlvbl9sb2dzIG5sXHJcbiAgICAgICAgTEVGVCBKT0lOIGxpY2Vuc2VzIGwgT04gbmwubGljZW5zZV9pZCA9IGwuaWRcclxuICAgICAgICBMRUZUIEpPSU4gc2hvcHMgcyBPTiBsLnNob3BfaWQgPSBzLmlkXHJcbiAgICAgICAgT1JERVIgQlkgbmwuc2VudF9hdCBERVNDXHJcbiAgICAgICAgTElNSVQgNTBcclxuICAgIGApO1xyXG4gICAgLy8gQXNzdW1pbmcgNTAgbGltaXQgZm9yIG5vdywgUEhQcyBjb25maWcgaGFkIGEgY29uc3RhbnRcclxuXHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBzdWNjZXNzOiB0cnVlLCBsb2dzIH0pO1xyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVTYXZlU2V0dGluZ3MocmVxdWVzdCkge1xyXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xyXG5cclxuICAgIC8vIFByZXBhcmUgdXBkYXRlIGRhdGFcclxuICAgIGNvbnN0IHVwZGF0ZURhdGEgPSB7XHJcbiAgICAgICAgZGF5c19iZWZvcmVfZXhwaXJ5OiBwYXJzZUludChkYXRhLmRheXNfYmVmb3JlX2V4cGlyeSB8fCAzMCksXHJcbiAgICAgICAgaXNfYWN0aXZlOiBkYXRhLmlzX2FjdGl2ZSA/IDEgOiAwXHJcbiAgICB9O1xyXG5cclxuICAgIGlmIChkYXRhLnRlbGVncmFtX2JvdF90b2tlbikge1xyXG4gICAgICAgIHVwZGF0ZURhdGEudGVsZWdyYW1fYm90X3Rva2VuID0gZGF0YS50ZWxlZ3JhbV9ib3RfdG9rZW47XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGRhdGEudGVsZWdyYW1fY2hhdF9pZCkge1xyXG4gICAgICAgIHVwZGF0ZURhdGEudGVsZWdyYW1fY2hhdF9pZCA9IGRhdGEudGVsZWdyYW1fY2hhdF9pZDtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBleGlzdHMgPSBhd2FpdCBmZXRjaE9uZShcIlNFTEVDVCBpZCBGUk9NIG5vdGlmaWNhdGlvbl9zZXR0aW5ncyBXSEVSRSBpZCA9IDFcIik7XHJcbiAgICBpZiAoZXhpc3RzKSB7XHJcbiAgICAgICAgYXdhaXQgdXBkYXRlKCdub3RpZmljYXRpb25fc2V0dGluZ3MnLCB1cGRhdGVEYXRhLCAnaWQgPSAkMScsIFsxXSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHVwZGF0ZURhdGEuaWQgPSAxO1xyXG4gICAgICAgIGF3YWl0IGluc2VydCgnbm90aWZpY2F0aW9uX3NldHRpbmdzJywgdXBkYXRlRGF0YSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgc3VjY2VzczogdHJ1ZSwgbWVzc2FnZTogJ+C4muC4seC4meC4l+C4tuC4geC4geC4suC4o+C4leC4seC5ieC4h+C4hOC5iOC4suC4quC4s+C5gOC4o+C5h+C4iCcgfSk7XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZVRlc3ROb3RpZmljYXRpb24oKSB7XHJcbiAgICBjb25zdCB7IHRlbGVncmFtU2VydmljZSwgbm90aWZpY2F0aW9uU2VydmljZSB9ID0gYXdhaXQgZ2V0U2VydmljZXMoKTtcclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBjb25maWcgZmlyc3RcclxuICAgIGlmICghdGVsZWdyYW1TZXJ2aWNlLmJvdFRva2VuIHx8ICF0ZWxlZ3JhbVNlcnZpY2UuY2hhdElkKSB7XHJcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6ICfguIHguKPguLjguJPguLLguJXguLHguYnguIfguITguYjguLIgVGVsZWdyYW0gQm90IFRva2VuIOC5geC4peC4sCBDaGF0IElEIOC4geC5iOC4reC4mScgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgbm90aWZpY2F0aW9uU2VydmljZS5zZW5kVGVzdE5vdGlmaWNhdGlvbigpO1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHJlc3VsdCk7XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUNoZWNrRXhwaXJpbmcoKSB7XHJcbiAgICBjb25zdCB7IHRlbGVncmFtU2VydmljZSwgbm90aWZpY2F0aW9uU2VydmljZSB9ID0gYXdhaXQgZ2V0U2VydmljZXMoKTtcclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBjb25maWdcclxuICAgIGlmICghdGVsZWdyYW1TZXJ2aWNlLmJvdFRva2VuIHx8ICF0ZWxlZ3JhbVNlcnZpY2UuY2hhdElkKSB7XHJcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6ICfguIHguKPguLjguJPguLLguJXguLHguYnguIfguITguYjguLIgVGVsZWdyYW0gQm90IFRva2VuIOC5geC4peC4sCBDaGF0IElEIOC4geC5iOC4reC4mScgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgbm90aWZpY2F0aW9uU2VydmljZS5jaGVja0FuZFNlbmRFeHBpcnlOb3RpZmljYXRpb25zKCk7XHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24ocmVzdWx0KTtcclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gZ2V0U2VydmljZXMoKSB7XHJcbiAgICBsZXQgc2V0dGluZ3MgPSBhd2FpdCBmZXRjaE9uZShcIlNFTEVDVCAqIEZST00gbm90aWZpY2F0aW9uX3NldHRpbmdzIFdIRVJFIGlkID0gMVwiKTtcclxuICAgIGlmICghc2V0dGluZ3MpIHtcclxuICAgICAgICBhd2FpdCBpbnNlcnQoJ25vdGlmaWNhdGlvbl9zZXR0aW5ncycsIHsgaWQ6IDEsIGRheXNfYmVmb3JlX2V4cGlyeTogMzAsIGlzX2FjdGl2ZTogMCB9KTtcclxuICAgICAgICBzZXR0aW5ncyA9IGF3YWl0IGZldGNoT25lKFwiU0VMRUNUICogRlJPTSBub3RpZmljYXRpb25fc2V0dGluZ3MgV0hFUkUgaWQgPSAxXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHRlbGVncmFtU2VydmljZSA9IG5ldyBUZWxlZ3JhbVNlcnZpY2Uoc2V0dGluZ3MudGVsZWdyYW1fYm90X3Rva2VuLCBzZXR0aW5ncy50ZWxlZ3JhbV9jaGF0X2lkKTtcclxuICAgIGNvbnN0IG5vdGlmaWNhdGlvblNlcnZpY2UgPSBuZXcgTm90aWZpY2F0aW9uU2VydmljZSh0ZWxlZ3JhbVNlcnZpY2UsIHNldHRpbmdzKTtcclxuXHJcbiAgICByZXR1cm4geyB0ZWxlZ3JhbVNlcnZpY2UsIG5vdGlmaWNhdGlvblNlcnZpY2UgfTtcclxufVxyXG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiY29va2llcyIsImdldElyb25TZXNzaW9uIiwic2Vzc2lvbk9wdGlvbnMiLCJmZXRjaE9uZSIsImZldGNoQWxsIiwidXBkYXRlIiwiaW5zZXJ0IiwiVGVsZWdyYW1TZXJ2aWNlIiwiTm90aWZpY2F0aW9uU2VydmljZSIsIkdFVCIsInJlcXVlc3QiLCJzZXNzaW9uIiwiZ2V0U2Vzc2lvbiIsInVzZXJJZCIsImpzb24iLCJzdWNjZXNzIiwibWVzc2FnZSIsInN0YXR1cyIsInNlYXJjaFBhcmFtcyIsIlVSTCIsInVybCIsImFjdGlvbiIsImdldCIsImhhbmRsZUdldFNldHRpbmdzIiwiaGFuZGxlR2V0TG9ncyIsIlBPU1QiLCJyb2xlIiwiaGFuZGxlU2F2ZVNldHRpbmdzIiwiaGFuZGxlVGVzdE5vdGlmaWNhdGlvbiIsImhhbmRsZUNoZWNrRXhwaXJpbmciLCJlcnJvciIsImNvbnNvbGUiLCJjb29raWVTdG9yZSIsInNldHRpbmdzIiwiaWQiLCJkYXlzX2JlZm9yZV9leHBpcnkiLCJpc19hY3RpdmUiLCJ0ZWxlZ3JhbV9ib3RfdG9rZW4iLCJ0b2tlbiIsInN0YXJ0Iiwic3Vic3RyaW5nIiwiZW5kIiwibGVuZ3RoIiwidGVsZWdyYW1fYm90X3Rva2VuX21hc2tlZCIsImxvZ3MiLCJkYXRhIiwidXBkYXRlRGF0YSIsInBhcnNlSW50IiwidGVsZWdyYW1fY2hhdF9pZCIsImV4aXN0cyIsInRlbGVncmFtU2VydmljZSIsIm5vdGlmaWNhdGlvblNlcnZpY2UiLCJnZXRTZXJ2aWNlcyIsImJvdFRva2VuIiwiY2hhdElkIiwicmVzdWx0Iiwic2VuZFRlc3ROb3RpZmljYXRpb24iLCJjaGVja0FuZFNlbmRFeHBpcnlOb3RpZmljYXRpb25zIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/notifications/route.js\n");

/***/ }),

/***/ "(rsc)/./src/lib/db.js":
/*!***********************!*\
  !*** ./src/lib/db.js ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   fetchAll: () => (/* binding */ fetchAll),\n/* harmony export */   fetchOne: () => (/* binding */ fetchOne),\n/* harmony export */   insert: () => (/* binding */ insert),\n/* harmony export */   query: () => (/* binding */ query),\n/* harmony export */   remove: () => (/* binding */ remove),\n/* harmony export */   update: () => (/* binding */ update)\n/* harmony export */ });\n/* harmony import */ var _neondatabase_serverless__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @neondatabase/serverless */ \"(rsc)/./node_modules/@neondatabase/serverless/index.mjs\");\n\n// Create Neon SQL client\nconst sql = (0,_neondatabase_serverless__WEBPACK_IMPORTED_MODULE_0__.neon)(process.env.DATABASE_URL);\n// Database helper functions\nasync function query(sqlQuery, params = []) {\n    const results = await sql(sqlQuery, params);\n    return results;\n}\nasync function fetchOne(sqlQuery, params = []) {\n    const results = await query(sqlQuery, params);\n    return results[0] || null;\n}\nasync function fetchAll(sqlQuery, params = []) {\n    return await query(sqlQuery, params);\n}\nasync function insert(table, data) {\n    const columns = Object.keys(data).join(\", \");\n    const placeholders = Object.keys(data).map((_, i)=>`$${i + 1}`).join(\", \");\n    const values = Object.values(data);\n    const sqlQuery = `INSERT INTO ${table} (${columns}) VALUES (${placeholders}) RETURNING id`;\n    const result = await sql(sqlQuery, values);\n    return result[0]?.id;\n}\nasync function update(table, data, where, whereParams = []) {\n    const setClause = Object.keys(data).map((key, i)=>`${key} = $${i + 1}`).join(\", \");\n    const values = [\n        ...Object.values(data),\n        ...whereParams\n    ];\n    const whereOffset = Object.keys(data).length + 1;\n    // Replace ? with $n in where clause\n    let paramIndex = whereOffset;\n    const whereClause = where.replace(/\\?/g, ()=>`$${paramIndex++}`);\n    const sqlQuery = `UPDATE ${table} SET ${setClause} WHERE ${whereClause}`;\n    const result = await sql(sqlQuery, values);\n    return result.length;\n}\nasync function remove(table, where, params = []) {\n    // Replace ? with $n in where clause\n    let paramIndex = 1;\n    const whereClause = where.replace(/\\?/g, ()=>`$${paramIndex++}`);\n    const sqlQuery = `DELETE FROM ${table} WHERE ${whereClause}`;\n    const result = await sql(sqlQuery, params);\n    return result.length;\n}\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (sql);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2RiLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQWdEO0FBRWhELHlCQUF5QjtBQUN6QixNQUFNQyxNQUFNRCw4REFBSUEsQ0FBQ0UsUUFBUUMsR0FBRyxDQUFDQyxZQUFZO0FBRXpDLDRCQUE0QjtBQUNyQixlQUFlQyxNQUFNQyxRQUFRLEVBQUVDLFNBQVMsRUFBRTtJQUM3QyxNQUFNQyxVQUFVLE1BQU1QLElBQUlLLFVBQVVDO0lBQ3BDLE9BQU9DO0FBQ1g7QUFFTyxlQUFlQyxTQUFTSCxRQUFRLEVBQUVDLFNBQVMsRUFBRTtJQUNoRCxNQUFNQyxVQUFVLE1BQU1ILE1BQU1DLFVBQVVDO0lBQ3RDLE9BQU9DLE9BQU8sQ0FBQyxFQUFFLElBQUk7QUFDekI7QUFFTyxlQUFlRSxTQUFTSixRQUFRLEVBQUVDLFNBQVMsRUFBRTtJQUNoRCxPQUFPLE1BQU1GLE1BQU1DLFVBQVVDO0FBQ2pDO0FBRU8sZUFBZUksT0FBT0MsS0FBSyxFQUFFQyxJQUFJO0lBQ3BDLE1BQU1DLFVBQVVDLE9BQU9DLElBQUksQ0FBQ0gsTUFBTUksSUFBSSxDQUFDO0lBQ3ZDLE1BQU1DLGVBQWVILE9BQU9DLElBQUksQ0FBQ0gsTUFBTU0sR0FBRyxDQUFDLENBQUNDLEdBQUdDLElBQU0sQ0FBQyxDQUFDLEVBQUVBLElBQUksRUFBRSxDQUFDLEVBQUVKLElBQUksQ0FBQztJQUN2RSxNQUFNSyxTQUFTUCxPQUFPTyxNQUFNLENBQUNUO0lBRTdCLE1BQU1QLFdBQVcsQ0FBQyxZQUFZLEVBQUVNLE1BQU0sRUFBRSxFQUFFRSxRQUFRLFVBQVUsRUFBRUksYUFBYSxjQUFjLENBQUM7SUFDMUYsTUFBTUssU0FBUyxNQUFNdEIsSUFBSUssVUFBVWdCO0lBQ25DLE9BQU9DLE1BQU0sQ0FBQyxFQUFFLEVBQUVDO0FBQ3RCO0FBRU8sZUFBZUMsT0FBT2IsS0FBSyxFQUFFQyxJQUFJLEVBQUVhLEtBQUssRUFBRUMsY0FBYyxFQUFFO0lBQzdELE1BQU1DLFlBQVliLE9BQU9DLElBQUksQ0FBQ0gsTUFBTU0sR0FBRyxDQUFDLENBQUNVLEtBQUtSLElBQU0sQ0FBQyxFQUFFUSxJQUFJLElBQUksRUFBRVIsSUFBSSxFQUFFLENBQUMsRUFBRUosSUFBSSxDQUFDO0lBQy9FLE1BQU1LLFNBQVM7V0FBSVAsT0FBT08sTUFBTSxDQUFDVDtXQUFVYztLQUFZO0lBQ3ZELE1BQU1HLGNBQWNmLE9BQU9DLElBQUksQ0FBQ0gsTUFBTWtCLE1BQU0sR0FBRztJQUUvQyxvQ0FBb0M7SUFDcEMsSUFBSUMsYUFBYUY7SUFDakIsTUFBTUcsY0FBY1AsTUFBTVEsT0FBTyxDQUFDLE9BQU8sSUFBTSxDQUFDLENBQUMsRUFBRUYsYUFBYSxDQUFDO0lBRWpFLE1BQU0xQixXQUFXLENBQUMsT0FBTyxFQUFFTSxNQUFNLEtBQUssRUFBRWdCLFVBQVUsT0FBTyxFQUFFSyxZQUFZLENBQUM7SUFDeEUsTUFBTVYsU0FBUyxNQUFNdEIsSUFBSUssVUFBVWdCO0lBQ25DLE9BQU9DLE9BQU9RLE1BQU07QUFDeEI7QUFFTyxlQUFlSSxPQUFPdkIsS0FBSyxFQUFFYyxLQUFLLEVBQUVuQixTQUFTLEVBQUU7SUFDbEQsb0NBQW9DO0lBQ3BDLElBQUl5QixhQUFhO0lBQ2pCLE1BQU1DLGNBQWNQLE1BQU1RLE9BQU8sQ0FBQyxPQUFPLElBQU0sQ0FBQyxDQUFDLEVBQUVGLGFBQWEsQ0FBQztJQUVqRSxNQUFNMUIsV0FBVyxDQUFDLFlBQVksRUFBRU0sTUFBTSxPQUFPLEVBQUVxQixZQUFZLENBQUM7SUFDNUQsTUFBTVYsU0FBUyxNQUFNdEIsSUFBSUssVUFBVUM7SUFDbkMsT0FBT2dCLE9BQU9RLE1BQU07QUFDeEI7QUFFQSxpRUFBZTlCLEdBQUdBLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zaG9wLWxpY2Vuc2Utc3lzdGVtLy4vc3JjL2xpYi9kYi5qcz83ZjlhIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IG5lb24gfSBmcm9tICdAbmVvbmRhdGFiYXNlL3NlcnZlcmxlc3MnO1xyXG5cclxuLy8gQ3JlYXRlIE5lb24gU1FMIGNsaWVudFxyXG5jb25zdCBzcWwgPSBuZW9uKHByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTCk7XHJcblxyXG4vLyBEYXRhYmFzZSBoZWxwZXIgZnVuY3Rpb25zXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBxdWVyeShzcWxRdWVyeSwgcGFyYW1zID0gW10pIHtcclxuICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBzcWwoc3FsUXVlcnksIHBhcmFtcyk7XHJcbiAgICByZXR1cm4gcmVzdWx0cztcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZldGNoT25lKHNxbFF1ZXJ5LCBwYXJhbXMgPSBbXSkge1xyXG4gICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IHF1ZXJ5KHNxbFF1ZXJ5LCBwYXJhbXMpO1xyXG4gICAgcmV0dXJuIHJlc3VsdHNbMF0gfHwgbnVsbDtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZldGNoQWxsKHNxbFF1ZXJ5LCBwYXJhbXMgPSBbXSkge1xyXG4gICAgcmV0dXJuIGF3YWl0IHF1ZXJ5KHNxbFF1ZXJ5LCBwYXJhbXMpO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaW5zZXJ0KHRhYmxlLCBkYXRhKSB7XHJcbiAgICBjb25zdCBjb2x1bW5zID0gT2JqZWN0LmtleXMoZGF0YSkuam9pbignLCAnKTtcclxuICAgIGNvbnN0IHBsYWNlaG9sZGVycyA9IE9iamVjdC5rZXlzKGRhdGEpLm1hcCgoXywgaSkgPT4gYCQke2kgKyAxfWApLmpvaW4oJywgJyk7XHJcbiAgICBjb25zdCB2YWx1ZXMgPSBPYmplY3QudmFsdWVzKGRhdGEpO1xyXG5cclxuICAgIGNvbnN0IHNxbFF1ZXJ5ID0gYElOU0VSVCBJTlRPICR7dGFibGV9ICgke2NvbHVtbnN9KSBWQUxVRVMgKCR7cGxhY2Vob2xkZXJzfSkgUkVUVVJOSU5HIGlkYDtcclxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNxbChzcWxRdWVyeSwgdmFsdWVzKTtcclxuICAgIHJldHVybiByZXN1bHRbMF0/LmlkO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlKHRhYmxlLCBkYXRhLCB3aGVyZSwgd2hlcmVQYXJhbXMgPSBbXSkge1xyXG4gICAgY29uc3Qgc2V0Q2xhdXNlID0gT2JqZWN0LmtleXMoZGF0YSkubWFwKChrZXksIGkpID0+IGAke2tleX0gPSAkJHtpICsgMX1gKS5qb2luKCcsICcpO1xyXG4gICAgY29uc3QgdmFsdWVzID0gWy4uLk9iamVjdC52YWx1ZXMoZGF0YSksIC4uLndoZXJlUGFyYW1zXTtcclxuICAgIGNvbnN0IHdoZXJlT2Zmc2V0ID0gT2JqZWN0LmtleXMoZGF0YSkubGVuZ3RoICsgMTtcclxuXHJcbiAgICAvLyBSZXBsYWNlID8gd2l0aCAkbiBpbiB3aGVyZSBjbGF1c2VcclxuICAgIGxldCBwYXJhbUluZGV4ID0gd2hlcmVPZmZzZXQ7XHJcbiAgICBjb25zdCB3aGVyZUNsYXVzZSA9IHdoZXJlLnJlcGxhY2UoL1xcPy9nLCAoKSA9PiBgJCR7cGFyYW1JbmRleCsrfWApO1xyXG5cclxuICAgIGNvbnN0IHNxbFF1ZXJ5ID0gYFVQREFURSAke3RhYmxlfSBTRVQgJHtzZXRDbGF1c2V9IFdIRVJFICR7d2hlcmVDbGF1c2V9YDtcclxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNxbChzcWxRdWVyeSwgdmFsdWVzKTtcclxuICAgIHJldHVybiByZXN1bHQubGVuZ3RoO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVtb3ZlKHRhYmxlLCB3aGVyZSwgcGFyYW1zID0gW10pIHtcclxuICAgIC8vIFJlcGxhY2UgPyB3aXRoICRuIGluIHdoZXJlIGNsYXVzZVxyXG4gICAgbGV0IHBhcmFtSW5kZXggPSAxO1xyXG4gICAgY29uc3Qgd2hlcmVDbGF1c2UgPSB3aGVyZS5yZXBsYWNlKC9cXD8vZywgKCkgPT4gYCQke3BhcmFtSW5kZXgrK31gKTtcclxuXHJcbiAgICBjb25zdCBzcWxRdWVyeSA9IGBERUxFVEUgRlJPTSAke3RhYmxlfSBXSEVSRSAke3doZXJlQ2xhdXNlfWA7XHJcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzcWwoc3FsUXVlcnksIHBhcmFtcyk7XHJcbiAgICByZXR1cm4gcmVzdWx0Lmxlbmd0aDtcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgc3FsO1xyXG4iXSwibmFtZXMiOlsibmVvbiIsInNxbCIsInByb2Nlc3MiLCJlbnYiLCJEQVRBQkFTRV9VUkwiLCJxdWVyeSIsInNxbFF1ZXJ5IiwicGFyYW1zIiwicmVzdWx0cyIsImZldGNoT25lIiwiZmV0Y2hBbGwiLCJpbnNlcnQiLCJ0YWJsZSIsImRhdGEiLCJjb2x1bW5zIiwiT2JqZWN0Iiwia2V5cyIsImpvaW4iLCJwbGFjZWhvbGRlcnMiLCJtYXAiLCJfIiwiaSIsInZhbHVlcyIsInJlc3VsdCIsImlkIiwidXBkYXRlIiwid2hlcmUiLCJ3aGVyZVBhcmFtcyIsInNldENsYXVzZSIsImtleSIsIndoZXJlT2Zmc2V0IiwibGVuZ3RoIiwicGFyYW1JbmRleCIsIndoZXJlQ2xhdXNlIiwicmVwbGFjZSIsInJlbW92ZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/db.js\n");

/***/ }),

/***/ "(rsc)/./src/lib/notification-service.js":
/*!*****************************************!*\
  !*** ./src/lib/notification-service.js ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   NotificationService: () => (/* binding */ NotificationService)\n/* harmony export */ });\n/* harmony import */ var _lib_db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/db */ \"(rsc)/./src/lib/db.js\");\n/* harmony import */ var _telegram__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./telegram */ \"(rsc)/./src/lib/telegram.js\");\n\n\n// Replicating PHP constant\nconst DEFAULT_DAYS_BEFORE_EXPIRY = 30;\nconst RATE_LIMIT_DELAY_MS = 100; // microseconds in PHP was small, using small MS here\nclass NotificationService {\n    constructor(telegramService, settings){\n        this.telegramService = telegramService;\n        this.settings = settings;\n    }\n    /**\r\n     * Check for expiring licenses and send notifications\r\n     */ async checkAndSendExpiryNotifications() {\n        if (!this.isNotificationSystemActive()) {\n            return {\n                success: false,\n                message: \"ระบบแจ้งเตือนถูกปิดอยู่\"\n            };\n        }\n        const expiringLicenses = await this.getExpiringLicenses();\n        if (!expiringLicenses || expiringLicenses.length === 0) {\n            return {\n                success: true,\n                message: \"ไม่มีใบอนุญาตที่ต้องแจ้งเตือน\"\n            };\n        }\n        return await this.sendNotificationsForLicenses(expiringLicenses);\n    }\n    async getExpiringLicenses() {\n        const daysBeforeExpiry = this.getDaysBeforeExpiry();\n        // Node-postgres uses $1, $2 placeholders parameters\n        // Need to simulate DATEDIFF and CURDATE() for PostgreSQL if using generic SQL,\n        // or keep using what works for the specific DB.\n        // Assuming the underlying DB is PostgreSQL (Neon), specific syntax changes might be needed\n        // compared to MySQL.\n        // Postgres: CURRENT_DATE, - operator for dates returns integer days\n        // Original PHP/MySQL:\n        // DATEDIFF(l.expiry_date, CURDATE()) as days_until_expiry\n        // WHERE l.expiry_date BETWEEN CURDATE() AND DATE_ADD(CURDATE(), INTERVAL ? DAY)\n        // AND DATE(nl.sent_at) = CURDATE()\n        // PostgreSQL equivalent:\n        // (l.expiry_date - CURRENT_DATE) as days_until_expiry\n        // WHERE l.expiry_date BETWEEN CURRENT_DATE AND CURRENT_DATE + interval 'X days'\n        // AND nl.sent_at::date = CURRENT_DATE\n        const query = `\r\n            SELECT l.*, s.shop_name, lt.type_name,\r\n                   (l.expiry_date - CURRENT_DATE) as days_until_expiry\r\n            FROM licenses l \r\n            JOIN shops s ON l.shop_id = s.id\r\n            JOIN license_types lt ON l.license_type_id = lt.id\r\n            LEFT JOIN notification_logs nl ON l.id = nl.license_id \r\n                AND nl.sent_at::date = CURRENT_DATE\r\n            WHERE l.status = 'active' \r\n            AND l.expiry_date BETWEEN CURRENT_DATE AND (CURRENT_DATE + ($1 || ' days')::interval)\r\n            AND nl.id IS NULL\r\n            ORDER BY l.expiry_date ASC\r\n        `;\n        return await (0,_lib_db__WEBPACK_IMPORTED_MODULE_0__.fetchAll)(query, [\n            daysBeforeExpiry\n        ]);\n    }\n    async sendTestNotification() {\n        const result = await this.telegramService.sendTestNotification();\n        if (result.success) {\n            return {\n                success: true,\n                message: \"ส่งข้อความทดสอบสำเร็จ\"\n            };\n        }\n        return {\n            success: false,\n            message: \"ส่งข้อความล้มเหลว: \" + result.error\n        };\n    }\n    isNotificationSystemActive() {\n        return !!this.settings.is_active;\n    }\n    getDaysBeforeExpiry() {\n        return parseInt(this.settings.days_before_expiry || DEFAULT_DAYS_BEFORE_EXPIRY);\n    }\n    async sendNotificationsForLicenses(licenses) {\n        let successCount = 0;\n        let failCount = 0;\n        for (const license of licenses){\n            const wasSuccessful = await this.sendAndLogNotification(license);\n            if (wasSuccessful) successCount++;\n            else failCount++;\n            // Rate limit delay\n            await new Promise((resolve)=>setTimeout(resolve, RATE_LIMIT_DELAY_MS));\n        }\n        return {\n            success: true,\n            message: `ส่งแจ้งเตือนสำเร็จ ${successCount} รายการ, ล้มเหลว ${failCount} รายการ`,\n            data: {\n                success_count: successCount,\n                fail_count: failCount\n            }\n        };\n    }\n    async sendAndLogNotification(license) {\n        const result = await this.telegramService.sendExpiryNotification(license);\n        await this.logNotification(license.id, result.success, result.success ? \"Sent\" : result.error || \"Failed\");\n        return result.success;\n    }\n    async logNotification(licenseId, success, message) {\n        await (0,_lib_db__WEBPACK_IMPORTED_MODULE_0__.insert)(\"notification_logs\", {\n            license_id: licenseId,\n            status: success ? \"success\" : \"failed\",\n            message: message\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LE9BQU9ELE9BQU9WLE9BQU87SUFDekI7SUFFQSxNQUFNNEIsZ0JBQWdCRSxTQUFTLEVBQUU5QixPQUFPLEVBQUVDLE9BQU8sRUFBRTtRQUMvQyxNQUFNWiwrQ0FBTUEsQ0FBQyxxQkFBcUI7WUFDOUIwQyxZQUFZRDtZQUNaRSxRQUFRaEMsVUFBVSxZQUFZO1lBQzlCQyxTQUFTQTtRQUViO0lBQ0o7QUFDSiIsInNvdXJjZXMiOlsid2VicGFjazovL3Nob3AtbGljZW5zZS1zeXN0ZW0vLi9zcmMvbGliL25vdGlmaWNhdGlvbi1zZXJ2aWNlLmpzP2RmNTkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaW5zZXJ0LCBmZXRjaEFsbCB9IGZyb20gJ0AvbGliL2RiJztcclxuaW1wb3J0IHsgVGVsZWdyYW1TZXJ2aWNlIH0gZnJvbSAnLi90ZWxlZ3JhbSc7XHJcblxyXG4vLyBSZXBsaWNhdGluZyBQSFAgY29uc3RhbnRcclxuY29uc3QgREVGQVVMVF9EQVlTX0JFRk9SRV9FWFBJUlkgPSAzMDtcclxuY29uc3QgUkFURV9MSU1JVF9ERUxBWV9NUyA9IDEwMDsgLy8gbWljcm9zZWNvbmRzIGluIFBIUCB3YXMgc21hbGwsIHVzaW5nIHNtYWxsIE1TIGhlcmVcclxuXHJcbmV4cG9ydCBjbGFzcyBOb3RpZmljYXRpb25TZXJ2aWNlIHtcclxuICAgIGNvbnN0cnVjdG9yKHRlbGVncmFtU2VydmljZSwgc2V0dGluZ3MpIHtcclxuICAgICAgICB0aGlzLnRlbGVncmFtU2VydmljZSA9IHRlbGVncmFtU2VydmljZTtcclxuICAgICAgICB0aGlzLnNldHRpbmdzID0gc2V0dGluZ3M7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDaGVjayBmb3IgZXhwaXJpbmcgbGljZW5zZXMgYW5kIHNlbmQgbm90aWZpY2F0aW9uc1xyXG4gICAgICovXHJcbiAgICBhc3luYyBjaGVja0FuZFNlbmRFeHBpcnlOb3RpZmljYXRpb25zKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5pc05vdGlmaWNhdGlvblN5c3RlbUFjdGl2ZSgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICfguKPguLDguJrguJrguYHguIjguYnguIfguYDguJXguLfguK3guJnguJbguLnguIHguJvguLTguJTguK3guKLguLnguYgnXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBleHBpcmluZ0xpY2Vuc2VzID0gYXdhaXQgdGhpcy5nZXRFeHBpcmluZ0xpY2Vuc2VzKCk7XHJcblxyXG4gICAgICAgIGlmICghZXhwaXJpbmdMaWNlbnNlcyB8fCBleHBpcmluZ0xpY2Vuc2VzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICfguYTguKHguYjguKHguLXguYPguJrguK3guJnguLjguI3guLLguJXguJfguLXguYjguJXguYnguK3guIfguYHguIjguYnguIfguYDguJXguLfguK3guJknXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5zZW5kTm90aWZpY2F0aW9uc0ZvckxpY2Vuc2VzKGV4cGlyaW5nTGljZW5zZXMpO1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIGdldEV4cGlyaW5nTGljZW5zZXMoKSB7XHJcbiAgICAgICAgY29uc3QgZGF5c0JlZm9yZUV4cGlyeSA9IHRoaXMuZ2V0RGF5c0JlZm9yZUV4cGlyeSgpO1xyXG5cclxuICAgICAgICAvLyBOb2RlLXBvc3RncmVzIHVzZXMgJDEsICQyIHBsYWNlaG9sZGVycyBwYXJhbWV0ZXJzXHJcbiAgICAgICAgLy8gTmVlZCB0byBzaW11bGF0ZSBEQVRFRElGRiBhbmQgQ1VSREFURSgpIGZvciBQb3N0Z3JlU1FMIGlmIHVzaW5nIGdlbmVyaWMgU1FMLFxyXG4gICAgICAgIC8vIG9yIGtlZXAgdXNpbmcgd2hhdCB3b3JrcyBmb3IgdGhlIHNwZWNpZmljIERCLlxyXG4gICAgICAgIC8vIEFzc3VtaW5nIHRoZSB1bmRlcmx5aW5nIERCIGlzIFBvc3RncmVTUUwgKE5lb24pLCBzcGVjaWZpYyBzeW50YXggY2hhbmdlcyBtaWdodCBiZSBuZWVkZWRcclxuICAgICAgICAvLyBjb21wYXJlZCB0byBNeVNRTC5cclxuICAgICAgICAvLyBQb3N0Z3JlczogQ1VSUkVOVF9EQVRFLCAtIG9wZXJhdG9yIGZvciBkYXRlcyByZXR1cm5zIGludGVnZXIgZGF5c1xyXG5cclxuICAgICAgICAvLyBPcmlnaW5hbCBQSFAvTXlTUUw6XHJcbiAgICAgICAgLy8gREFURURJRkYobC5leHBpcnlfZGF0ZSwgQ1VSREFURSgpKSBhcyBkYXlzX3VudGlsX2V4cGlyeVxyXG4gICAgICAgIC8vIFdIRVJFIGwuZXhwaXJ5X2RhdGUgQkVUV0VFTiBDVVJEQVRFKCkgQU5EIERBVEVfQUREKENVUkRBVEUoKSwgSU5URVJWQUwgPyBEQVkpXHJcbiAgICAgICAgLy8gQU5EIERBVEUobmwuc2VudF9hdCkgPSBDVVJEQVRFKClcclxuXHJcbiAgICAgICAgLy8gUG9zdGdyZVNRTCBlcXVpdmFsZW50OlxyXG4gICAgICAgIC8vIChsLmV4cGlyeV9kYXRlIC0gQ1VSUkVOVF9EQVRFKSBhcyBkYXlzX3VudGlsX2V4cGlyeVxyXG4gICAgICAgIC8vIFdIRVJFIGwuZXhwaXJ5X2RhdGUgQkVUV0VFTiBDVVJSRU5UX0RBVEUgQU5EIENVUlJFTlRfREFURSArIGludGVydmFsICdYIGRheXMnXHJcbiAgICAgICAgLy8gQU5EIG5sLnNlbnRfYXQ6OmRhdGUgPSBDVVJSRU5UX0RBVEVcclxuXHJcbiAgICAgICAgY29uc3QgcXVlcnkgPSBgXHJcbiAgICAgICAgICAgIFNFTEVDVCBsLiosIHMuc2hvcF9uYW1lLCBsdC50eXBlX25hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAobC5leHBpcnlfZGF0ZSAtIENVUlJFTlRfREFURSkgYXMgZGF5c191bnRpbF9leHBpcnlcclxuICAgICAgICAgICAgRlJPTSBsaWNlbnNlcyBsIFxyXG4gICAgICAgICAgICBKT0lOIHNob3BzIHMgT04gbC5zaG9wX2lkID0gcy5pZFxyXG4gICAgICAgICAgICBKT0lOIGxpY2Vuc2VfdHlwZXMgbHQgT04gbC5saWNlbnNlX3R5cGVfaWQgPSBsdC5pZFxyXG4gICAgICAgICAgICBMRUZUIEpPSU4gbm90aWZpY2F0aW9uX2xvZ3MgbmwgT04gbC5pZCA9IG5sLmxpY2Vuc2VfaWQgXHJcbiAgICAgICAgICAgICAgICBBTkQgbmwuc2VudF9hdDo6ZGF0ZSA9IENVUlJFTlRfREFURVxyXG4gICAgICAgICAgICBXSEVSRSBsLnN0YXR1cyA9ICdhY3RpdmUnIFxyXG4gICAgICAgICAgICBBTkQgbC5leHBpcnlfZGF0ZSBCRVRXRUVOIENVUlJFTlRfREFURSBBTkQgKENVUlJFTlRfREFURSArICgkMSB8fCAnIGRheXMnKTo6aW50ZXJ2YWwpXHJcbiAgICAgICAgICAgIEFORCBubC5pZCBJUyBOVUxMXHJcbiAgICAgICAgICAgIE9SREVSIEJZIGwuZXhwaXJ5X2RhdGUgQVNDXHJcbiAgICAgICAgYDtcclxuXHJcbiAgICAgICAgcmV0dXJuIGF3YWl0IGZldGNoQWxsKHF1ZXJ5LCBbZGF5c0JlZm9yZUV4cGlyeV0pO1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIHNlbmRUZXN0Tm90aWZpY2F0aW9uKCkge1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMudGVsZWdyYW1TZXJ2aWNlLnNlbmRUZXN0Tm90aWZpY2F0aW9uKCk7XHJcbiAgICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIG1lc3NhZ2U6ICfguKrguYjguIfguILguYnguK3guITguKfguLLguKHguJfguJTguKrguK3guJrguKrguLPguYDguKPguYfguIgnIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiAn4Liq4LmI4LiH4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4Lil4LmJ4Lih4LmA4Lir4Lil4LinOiAnICsgcmVzdWx0LmVycm9yIH07XHJcbiAgICB9XHJcblxyXG4gICAgaXNOb3RpZmljYXRpb25TeXN0ZW1BY3RpdmUoKSB7XHJcbiAgICAgICAgcmV0dXJuICEhdGhpcy5zZXR0aW5ncy5pc19hY3RpdmU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0RGF5c0JlZm9yZUV4cGlyeSgpIHtcclxuICAgICAgICByZXR1cm4gcGFyc2VJbnQodGhpcy5zZXR0aW5ncy5kYXlzX2JlZm9yZV9leHBpcnkgfHwgREVGQVVMVF9EQVlTX0JFRk9SRV9FWFBJUlkpO1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIHNlbmROb3RpZmljYXRpb25zRm9yTGljZW5zZXMobGljZW5zZXMpIHtcclxuICAgICAgICBsZXQgc3VjY2Vzc0NvdW50ID0gMDtcclxuICAgICAgICBsZXQgZmFpbENvdW50ID0gMDtcclxuXHJcbiAgICAgICAgZm9yIChjb25zdCBsaWNlbnNlIG9mIGxpY2Vuc2VzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHdhc1N1Y2Nlc3NmdWwgPSBhd2FpdCB0aGlzLnNlbmRBbmRMb2dOb3RpZmljYXRpb24obGljZW5zZSk7XHJcblxyXG4gICAgICAgICAgICBpZiAod2FzU3VjY2Vzc2Z1bCkgc3VjY2Vzc0NvdW50Kys7XHJcbiAgICAgICAgICAgIGVsc2UgZmFpbENvdW50Kys7XHJcblxyXG4gICAgICAgICAgICAvLyBSYXRlIGxpbWl0IGRlbGF5XHJcbiAgICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBSQVRFX0xJTUlUX0RFTEFZX01TKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiBg4Liq4LmI4LiH4LmB4LiI4LmJ4LiH4LmA4LiV4Li34Lit4LiZ4Liq4Liz4LmA4Lij4LmH4LiIICR7c3VjY2Vzc0NvdW50fSDguKPguLLguKLguIHguLLguKMsIOC4peC5ieC4oeC5gOC4q+C4peC4pyAke2ZhaWxDb3VudH0g4Lij4Liy4Lii4LiB4Liy4LijYCxcclxuICAgICAgICAgICAgZGF0YTogeyBzdWNjZXNzX2NvdW50OiBzdWNjZXNzQ291bnQsIGZhaWxfY291bnQ6IGZhaWxDb3VudCB9XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBzZW5kQW5kTG9nTm90aWZpY2F0aW9uKGxpY2Vuc2UpIHtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnRlbGVncmFtU2VydmljZS5zZW5kRXhwaXJ5Tm90aWZpY2F0aW9uKGxpY2Vuc2UpO1xyXG5cclxuICAgICAgICBhd2FpdCB0aGlzLmxvZ05vdGlmaWNhdGlvbihcclxuICAgICAgICAgICAgbGljZW5zZS5pZCxcclxuICAgICAgICAgICAgcmVzdWx0LnN1Y2Nlc3MsXHJcbiAgICAgICAgICAgIHJlc3VsdC5zdWNjZXNzID8gJ1NlbnQnIDogKHJlc3VsdC5lcnJvciB8fCAnRmFpbGVkJylcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICByZXR1cm4gcmVzdWx0LnN1Y2Nlc3M7XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgbG9nTm90aWZpY2F0aW9uKGxpY2Vuc2VJZCwgc3VjY2VzcywgbWVzc2FnZSkge1xyXG4gICAgICAgIGF3YWl0IGluc2VydCgnbm90aWZpY2F0aW9uX2xvZ3MnLCB7XHJcbiAgICAgICAgICAgIGxpY2Vuc2VfaWQ6IGxpY2Vuc2VJZCxcclxuICAgICAgICAgICAgc3RhdHVzOiBzdWNjZXNzID8gJ3N1Y2Nlc3MnIDogJ2ZhaWxlZCcsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UsXHJcbiAgICAgICAgICAgIC8vIHNlbnRfYXQgZGVmYXVsdHMgdG8gY3VycmVudCB0aW1lc3RhbXAgaW4gREIgdXN1YWxseSwgYnV0IHdlIGNhbiByZWx5IG9uIGRlZmF1bHRcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxyXG4iXSwibmFtZXMiOlsiaW5zZXJ0IiwiZmV0Y2hBbGwiLCJUZWxlZ3JhbVNlcnZpY2UiLCJERUZBVUxUX0RBWVNfQkVGT1JFX0VYUElSWSIsIlJBVEVfTElNSVRfREVMQVlfTVMiLCJOb3RpZmljYXRpb25TZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJ0ZWxlZ3JhbVNlcnZpY2UiLCJzZXR0aW5ncyIsImNoZWNrQW5kU2VuZEV4cGlyeU5vdGlmaWNhdGlvbnMiLCJpc05vdGlmaWNhdGlvblN5c3RlbUFjdGl2ZSIsInN1Y2Nlc3MiLCJtZXNzYWdlIiwiZXhwaXJpbmdMaWNlbnNlcyIsImdldEV4cGlyaW5nTGljZW5zZXMiLCJsZW5ndGgiLCJzZW5kTm90aWZpY2F0aW9uc0ZvckxpY2Vuc2VzIiwiZGF5c0JlZm9yZUV4cGlyeSIsImdldERheXNCZWZvcmVFeHBpcnkiLCJxdWVyeSIsInNlbmRUZXN0Tm90aWZpY2F0aW9uIiwicmVzdWx0IiwiZXJyb3IiLCJpc19hY3RpdmUiLCJwYXJzZUludCIsImRheXNfYmVmb3JlX2V4cGlyeSIsImxpY2Vuc2VzIiwic3VjY2Vzc0NvdW50IiwiZmFpbENvdW50IiwibGljZW5zZSIsIndhc1N1Y2Nlc3NmdWwiLCJzZW5kQW5kTG9nTm90aWZpY2F0aW9uIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0IiwiZGF0YSIsInN1Y2Nlc3NfY291bnQiLCJmYWlsX2NvdW50Iiwic2VuZEV4cGlyeU5vdGlmaWNhdGlvbiIsImxvZ05vdGlmaWNhdGlvbiIsImlkIiwibGljZW5zZUlkIiwibGljZW5zZV9pZCIsInN0YXR1cyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/notification-service.js\n");

/***/ }),

/***/ "(rsc)/./src/lib/session.js":
/*!****************************!*\
  !*** ./src/lib/session.js ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getSessionFromCookies: () => (/* binding */ getSessionFromCookies),\n/* harmony export */   sessionOptions: () => (/* binding */ sessionOptions)\n/* harmony export */ });\n/* harmony import */ var iron_session__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! iron-session */ \"(rsc)/./node_modules/iron-session/dist/index.js\");\n\nconst sessionOptions = {\n    password: process.env.SESSION_SECRET || \"complex_password_at_least_32_characters_long\",\n    cookieName: \"shop_license_session\",\n    cookieOptions: {\n        secure: \"development\" === \"production\",\n        httpOnly: true,\n        sameSite: \"lax\",\n        maxAge: 60 * 30\n    }\n};\nasync function getSessionFromCookies(cookies) {\n    return (0,iron_session__WEBPACK_IMPORTED_MODULE_0__.getIronSession)(cookies, sessionOptions);\n}\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3Nlc3Npb24uanMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQThDO0FBRTlDLE1BQU1DLGlCQUFpQjtJQUNuQkMsVUFBVUMsUUFBUUMsR0FBRyxDQUFDQyxjQUFjLElBQUk7SUFDeENDLFlBQVk7SUFDWkMsZUFBZTtRQUNYQyxRQUFRTCxrQkFBeUI7UUFDakNNLFVBQVU7UUFDVkMsVUFBVTtRQUNWQyxRQUFRLEtBQUs7SUFDakI7QUFDSjtBQUVPLGVBQWVDLHNCQUFzQkMsT0FBTztJQUMvQyxPQUFPYiw0REFBY0EsQ0FBQ2EsU0FBU1o7QUFDbkM7QUFFMEIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zaG9wLWxpY2Vuc2Utc3lzdGVtLy4vc3JjL2xpYi9zZXNzaW9uLmpzPzcxMDYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZ2V0SXJvblNlc3Npb24gfSBmcm9tICdpcm9uLXNlc3Npb24nO1xyXG5cclxuY29uc3Qgc2Vzc2lvbk9wdGlvbnMgPSB7XHJcbiAgICBwYXNzd29yZDogcHJvY2Vzcy5lbnYuU0VTU0lPTl9TRUNSRVQgfHwgJ2NvbXBsZXhfcGFzc3dvcmRfYXRfbGVhc3RfMzJfY2hhcmFjdGVyc19sb25nJyxcclxuICAgIGNvb2tpZU5hbWU6ICdzaG9wX2xpY2Vuc2Vfc2Vzc2lvbicsXHJcbiAgICBjb29raWVPcHRpb25zOiB7XHJcbiAgICAgICAgc2VjdXJlOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nLFxyXG4gICAgICAgIGh0dHBPbmx5OiB0cnVlLFxyXG4gICAgICAgIHNhbWVTaXRlOiAnbGF4JyxcclxuICAgICAgICBtYXhBZ2U6IDYwICogMzAsIC8vIDMwIG1pbnV0ZXNcclxuICAgIH0sXHJcbn07XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0U2Vzc2lvbkZyb21Db29raWVzKGNvb2tpZXMpIHtcclxuICAgIHJldHVybiBnZXRJcm9uU2Vzc2lvbihjb29raWVzLCBzZXNzaW9uT3B0aW9ucyk7XHJcbn1cclxuXHJcbmV4cG9ydCB7IHNlc3Npb25PcHRpb25zIH07XHJcbiJdLCJuYW1lcyI6WyJnZXRJcm9uU2Vzc2lvbiIsInNlc3Npb25PcHRpb25zIiwicGFzc3dvcmQiLCJwcm9jZXNzIiwiZW52IiwiU0VTU0lPTl9TRUNSRVQiLCJjb29raWVOYW1lIiwiY29va2llT3B0aW9ucyIsInNlY3VyZSIsImh0dHBPbmx5Iiwic2FtZVNpdGUiLCJtYXhBZ2UiLCJnZXRTZXNzaW9uRnJvbUNvb2tpZXMiLCJjb29raWVzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/session.js\n");

/***/ }),

/***/ "(rsc)/./src/lib/telegram.js":
/*!*****************************!*\
  !*** ./src/lib/telegram.js ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   NotificationConfig: () => (/* binding */ NotificationConfig),\n/* harmony export */   TelegramService: () => (/* binding */ TelegramService)\n/* harmony export */ });\nconst NotificationConfig = {\n    TELEGRAM_API_BASE_URL: \"https://api.telegram.org/bot\",\n    TELEGRAM_PARSE_MODE: \"HTML\",\n    // Default request timeout handled by fetch options if needed\n    TOKEN_MASK_START_LENGTH: 4,\n    TOKEN_MASK_END_LENGTH: 4\n};\nclass TelegramService {\n    constructor(botToken, chatId){\n        this.botToken = botToken;\n        this.chatId = chatId;\n    }\n    /**\r\n     * Send a message to Telegram\r\n     * @param {string} message \r\n     * @returns {Promise<{success: boolean, error: string|null}>}\r\n     */ async sendMessage(message) {\n        const apiUrl = this.buildApiUrl();\n        const postData = this.buildMessageData(message);\n        return this.executeRequest(apiUrl, postData);\n    }\n    /**\r\n     * Send an expiry notification for a license\r\n     * @param {object} license \r\n     * @returns {Promise<{success: boolean, error: string|null}>}\r\n     */ async sendExpiryNotification(license) {\n        const message = this.buildExpiryMessage(license);\n        return this.sendMessage(message);\n    }\n    /**\r\n     * Send a test notification\r\n     * @returns {Promise<{success: boolean, error: string|null}>}\r\n     */ async sendTestNotification() {\n        const message = this.buildTestMessage();\n        return this.sendMessage(message);\n    }\n    buildApiUrl() {\n        return `${NotificationConfig.TELEGRAM_API_BASE_URL}${this.botToken}/sendMessage`;\n    }\n    buildMessageData(message) {\n        // fetch expects body as string or URLSearchParams for generic POST\n        // For x-www-form-urlencoded:\n        const params = new URLSearchParams();\n        params.append(\"chat_id\", this.chatId);\n        params.append(\"text\", message);\n        params.append(\"parse_mode\", NotificationConfig.TELEGRAM_PARSE_MODE);\n        return params;\n    }\n    buildExpiryMessage(license) {\n        const lines = [\n            \"⚠️ แจ้งเตือนใบอนุญาตใกล้หมดอายุ\",\n            \"\",\n            `🏪 ร้าน: ${license.shop_name}`,\n            `📄 ประเภท: ${license.type_name}`,\n            `🔢 เลขที่: ${license.license_number}`,\n            `📅 หมดอายุ: ${this.formatDate(license.expiry_date)}`,\n            `⏰ เหลือ: ${license.days_until_expiry} วัน`\n        ];\n        return lines.join(\"\\n\");\n    }\n    buildTestMessage() {\n        const lines = [\n            \"\\uD83D\\uDD14 ทดสอบการแจ้งเตือน\",\n            \"\",\n            \"ระบบจัดการใบอนุญาตร้านค้า\",\n            `เวลา: ${new Date().toLocaleString(\"th-TH\")}`\n        ];\n        return lines.join(\"\\n\");\n    }\n    formatDate(dateStr) {\n        // Simple formatter, can use existing utils if imported, but keeping self-contained for lib\n        try {\n            return new Date(dateStr).toLocaleDateString(\"th-TH\", {\n                year: \"numeric\",\n                month: \"long\",\n                day: \"numeric\"\n            });\n        } catch  {\n            return dateStr;\n        }\n    }\n    async executeRequest(url, data) {\n        try {\n            const response = await fetch(url, {\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": \"application/x-www-form-urlencoded\"\n                },\n                body: data\n            });\n            const result = await response.json();\n            if (result.ok) {\n                return {\n                    success: true,\n                    error: null\n                };\n            } else {\n                return {\n                    success: false,\n                    error: result.description || \"Unknown Telegram error\"\n                };\n            }\n        } catch (error) {\n            return {\n                success: false,\n                error: error.message\n            };\n        }\n    }\n}\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUNYLE9BQU87b0JBQUVDLFNBQVM7b0JBQU1DLE9BQU87Z0JBQUs7WUFDeEMsT0FBTztnQkFDSCxPQUFPO29CQUFFRCxTQUFTO29CQUFPQyxPQUFPSixPQUFPSyxXQUFXLElBQUk7Z0JBQXlCO1lBQ25GO1FBQ0osRUFBRSxPQUFPRCxPQUFPO1lBQ1osT0FBTztnQkFBRUQsU0FBUztnQkFBT0MsT0FBT0EsTUFBTXhDLE9BQU87WUFBQztRQUNsRDtJQUNKO0FBQ0o7QUFFOEIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zaG9wLWxpY2Vuc2Utc3lzdGVtLy4vc3JjL2xpYi90ZWxlZ3JhbS5qcz9jZjAzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IE5vdGlmaWNhdGlvbkNvbmZpZyA9IHtcclxuICAgIFRFTEVHUkFNX0FQSV9CQVNFX1VSTDogJ2h0dHBzOi8vYXBpLnRlbGVncmFtLm9yZy9ib3QnLFxyXG4gICAgVEVMRUdSQU1fUEFSU0VfTU9ERTogJ0hUTUwnLFxyXG4gICAgLy8gRGVmYXVsdCByZXF1ZXN0IHRpbWVvdXQgaGFuZGxlZCBieSBmZXRjaCBvcHRpb25zIGlmIG5lZWRlZFxyXG4gICAgVE9LRU5fTUFTS19TVEFSVF9MRU5HVEg6IDQsXHJcbiAgICBUT0tFTl9NQVNLX0VORF9MRU5HVEg6IDQsXHJcbn07XHJcblxyXG5leHBvcnQgY2xhc3MgVGVsZWdyYW1TZXJ2aWNlIHtcclxuICAgIGNvbnN0cnVjdG9yKGJvdFRva2VuLCBjaGF0SWQpIHtcclxuICAgICAgICB0aGlzLmJvdFRva2VuID0gYm90VG9rZW47XHJcbiAgICAgICAgdGhpcy5jaGF0SWQgPSBjaGF0SWQ7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTZW5kIGEgbWVzc2FnZSB0byBUZWxlZ3JhbVxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG1lc3NhZ2UgXHJcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTx7c3VjY2VzczogYm9vbGVhbiwgZXJyb3I6IHN0cmluZ3xudWxsfT59XHJcbiAgICAgKi9cclxuICAgIGFzeW5jIHNlbmRNZXNzYWdlKG1lc3NhZ2UpIHtcclxuICAgICAgICBjb25zdCBhcGlVcmwgPSB0aGlzLmJ1aWxkQXBpVXJsKCk7XHJcbiAgICAgICAgY29uc3QgcG9zdERhdGEgPSB0aGlzLmJ1aWxkTWVzc2FnZURhdGEobWVzc2FnZSk7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmV4ZWN1dGVSZXF1ZXN0KGFwaVVybCwgcG9zdERhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogU2VuZCBhbiBleHBpcnkgbm90aWZpY2F0aW9uIGZvciBhIGxpY2Vuc2VcclxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBsaWNlbnNlIFxyXG4gICAgICogQHJldHVybnMge1Byb21pc2U8e3N1Y2Nlc3M6IGJvb2xlYW4sIGVycm9yOiBzdHJpbmd8bnVsbH0+fVxyXG4gICAgICovXHJcbiAgICBhc3luYyBzZW5kRXhwaXJ5Tm90aWZpY2F0aW9uKGxpY2Vuc2UpIHtcclxuICAgICAgICBjb25zdCBtZXNzYWdlID0gdGhpcy5idWlsZEV4cGlyeU1lc3NhZ2UobGljZW5zZSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VuZE1lc3NhZ2UobWVzc2FnZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTZW5kIGEgdGVzdCBub3RpZmljYXRpb25cclxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlPHtzdWNjZXNzOiBib29sZWFuLCBlcnJvcjogc3RyaW5nfG51bGx9Pn1cclxuICAgICAqL1xyXG4gICAgYXN5bmMgc2VuZFRlc3ROb3RpZmljYXRpb24oKSB7XHJcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IHRoaXMuYnVpbGRUZXN0TWVzc2FnZSgpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLnNlbmRNZXNzYWdlKG1lc3NhZ2UpO1xyXG4gICAgfVxyXG5cclxuICAgIGJ1aWxkQXBpVXJsKCkge1xyXG4gICAgICAgIHJldHVybiBgJHtOb3RpZmljYXRpb25Db25maWcuVEVMRUdSQU1fQVBJX0JBU0VfVVJMfSR7dGhpcy5ib3RUb2tlbn0vc2VuZE1lc3NhZ2VgO1xyXG4gICAgfVxyXG5cclxuICAgIGJ1aWxkTWVzc2FnZURhdGEobWVzc2FnZSkge1xyXG4gICAgICAgIC8vIGZldGNoIGV4cGVjdHMgYm9keSBhcyBzdHJpbmcgb3IgVVJMU2VhcmNoUGFyYW1zIGZvciBnZW5lcmljIFBPU1RcclxuICAgICAgICAvLyBGb3IgeC13d3ctZm9ybS11cmxlbmNvZGVkOlxyXG4gICAgICAgIGNvbnN0IHBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKTtcclxuICAgICAgICBwYXJhbXMuYXBwZW5kKCdjaGF0X2lkJywgdGhpcy5jaGF0SWQpO1xyXG4gICAgICAgIHBhcmFtcy5hcHBlbmQoJ3RleHQnLCBtZXNzYWdlKTtcclxuICAgICAgICBwYXJhbXMuYXBwZW5kKCdwYXJzZV9tb2RlJywgTm90aWZpY2F0aW9uQ29uZmlnLlRFTEVHUkFNX1BBUlNFX01PREUpO1xyXG4gICAgICAgIHJldHVybiBwYXJhbXM7XHJcbiAgICB9XHJcblxyXG4gICAgYnVpbGRFeHBpcnlNZXNzYWdlKGxpY2Vuc2UpIHtcclxuICAgICAgICBjb25zdCBsaW5lcyA9IFtcclxuICAgICAgICAgICAgXCLimqDvuI8g4LmB4LiI4LmJ4LiH4LmA4LiV4Li34Lit4LiZ4LmD4Lia4Lit4LiZ4Li44LiN4Liy4LiV4LmD4LiB4Lil4LmJ4Lir4Lih4LiU4Lit4Liy4Lii4Li4XCIsXHJcbiAgICAgICAgICAgIFwiXCIsXHJcbiAgICAgICAgICAgIGDwn4+qIOC4o+C5ieC4suC4mTogJHtsaWNlbnNlLnNob3BfbmFtZX1gLFxyXG4gICAgICAgICAgICBg8J+ThCDguJvguKPguLDguYDguKDguJc6ICR7bGljZW5zZS50eXBlX25hbWV9YCxcclxuICAgICAgICAgICAgYPCflKIg4LmA4Lil4LiC4LiX4Li14LmIOiAke2xpY2Vuc2UubGljZW5zZV9udW1iZXJ9YCxcclxuICAgICAgICAgICAgYPCfk4Ug4Lir4Lih4LiU4Lit4Liy4Lii4Li4OiAke3RoaXMuZm9ybWF0RGF0ZShsaWNlbnNlLmV4cGlyeV9kYXRlKX1gLFxyXG4gICAgICAgICAgICBg4o+wIOC5gOC4q+C4peC4t+C4rTogJHtsaWNlbnNlLmRheXNfdW50aWxfZXhwaXJ5fSDguKfguLHguJlgXHJcbiAgICAgICAgXTtcclxuICAgICAgICByZXR1cm4gbGluZXMuam9pbihcIlxcblwiKTtcclxuICAgIH1cclxuXHJcbiAgICBidWlsZFRlc3RNZXNzYWdlKCkge1xyXG4gICAgICAgIGNvbnN0IGxpbmVzID0gW1xyXG4gICAgICAgICAgICBcIvCflJQg4LiX4LiU4Liq4Lit4Lia4LiB4Liy4Lij4LmB4LiI4LmJ4LiH4LmA4LiV4Li34Lit4LiZXCIsXHJcbiAgICAgICAgICAgIFwiXCIsXHJcbiAgICAgICAgICAgIFwi4Lij4Liw4Lia4Lia4LiI4Lix4LiU4LiB4Liy4Lij4LmD4Lia4Lit4LiZ4Li44LiN4Liy4LiV4Lij4LmJ4Liy4LiZ4LiE4LmJ4LiyXCIsXHJcbiAgICAgICAgICAgIGDguYDguKfguKXguLI6ICR7bmV3IERhdGUoKS50b0xvY2FsZVN0cmluZygndGgtVEgnKX1gXHJcbiAgICAgICAgXTtcclxuICAgICAgICByZXR1cm4gbGluZXMuam9pbihcIlxcblwiKTtcclxuICAgIH1cclxuXHJcbiAgICBmb3JtYXREYXRlKGRhdGVTdHIpIHtcclxuICAgICAgICAvLyBTaW1wbGUgZm9ybWF0dGVyLCBjYW4gdXNlIGV4aXN0aW5nIHV0aWxzIGlmIGltcG9ydGVkLCBidXQga2VlcGluZyBzZWxmLWNvbnRhaW5lZCBmb3IgbGliXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGRhdGVTdHIpLnRvTG9jYWxlRGF0ZVN0cmluZygndGgtVEgnLCB7IHllYXI6ICdudW1lcmljJywgbW9udGg6ICdsb25nJywgZGF5OiAnbnVtZXJpYycgfSk7XHJcbiAgICAgICAgfSBjYXRjaCB7XHJcbiAgICAgICAgICAgIHJldHVybiBkYXRlU3RyO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBleGVjdXRlUmVxdWVzdCh1cmwsIGRhdGEpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwge1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnLFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGJvZHk6IGRhdGFcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAocmVzdWx0Lm9rKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBlcnJvcjogbnVsbCB9O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiByZXN1bHQuZGVzY3JpcHRpb24gfHwgJ1Vua25vd24gVGVsZWdyYW0gZXJyb3InIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IE5vdGlmaWNhdGlvbkNvbmZpZyB9O1xyXG4iXSwibmFtZXMiOlsiTm90aWZpY2F0aW9uQ29uZmlnIiwiVEVMRUdSQU1fQVBJX0JBU0VfVVJMIiwiVEVMRUdSQU1fUEFSU0VfTU9ERSIsIlRPS0VOX01BU0tfU1RBUlRfTEVOR1RIIiwiVE9LRU5fTUFTS19FTkRfTEVOR1RIIiwiVGVsZWdyYW1TZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJib3RUb2tlbiIsImNoYXRJZCIsInNlbmRNZXNzYWdlIiwibWVzc2FnZSIsImFwaVVybCIsImJ1aWxkQXBpVXJsIiwicG9zdERhdGEiLCJidWlsZE1lc3NhZ2VEYXRhIiwiZXhlY3V0ZVJlcXVlc3QiLCJzZW5kRXhwaXJ5Tm90aWZpY2F0aW9uIiwibGljZW5zZSIsImJ1aWxkRXhwaXJ5TWVzc2FnZSIsInNlbmRUZXN0Tm90aWZpY2F0aW9uIiwiYnVpbGRUZXN0TWVzc2FnZSIsInBhcmFtcyIsIlVSTFNlYXJjaFBhcmFtcyIsImFwcGVuZCIsImxpbmVzIiwic2hvcF9uYW1lIiwidHlwZV9uYW1lIiwibGljZW5zZV9udW1iZXIiLCJmb3JtYXREYXRlIiwiZXhwaXJ5X2RhdGUiLCJkYXlzX3VudGlsX2V4cGlyeSIsImpvaW4iLCJEYXRlIiwidG9Mb2NhbGVTdHJpbmciLCJkYXRlU3RyIiwidG9Mb2NhbGVEYXRlU3RyaW5nIiwieWVhciIsIm1vbnRoIiwiZGF5IiwidXJsIiwiZGF0YSIsInJlc3BvbnNlIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwiYm9keSIsInJlc3VsdCIsImpzb24iLCJvayIsInN1Y2Nlc3MiLCJlcnJvciIsImRlc2NyaXB0aW9uIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/telegram.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@neondatabase","vendor-chunks/iron-webcrypto","vendor-chunks/iron-session","vendor-chunks/cookie","vendor-chunks/uncrypto"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fnotifications%2Froute&page=%2Fapi%2Fnotifications%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fnotifications%2Froute.js&appDir=C%3A%5CUsers%5CRareMz%5CTest%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CRareMz%5CTest&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();